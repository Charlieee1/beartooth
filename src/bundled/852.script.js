(self.webpackChunkbeartooth=self.webpackChunkbeartooth||[]).push([[852],{8133:t=>{t.exports=function(t){var r=[];return t.replace(i,(function(t,i,s){var o=i.toLowerCase();for(s=function(t){var e=t.match(n);return e?e.map(Number):[]}(s),"m"==o&&s.length>2&&(r.push([i].concat(s.splice(0,2))),o="l",i="m"==i?"l":"L");;){if(s.length==e[o])return s.unshift(i),r.push(s);if(s.length<e[o])throw new Error("malformed path data");r.push([i].concat(s.splice(0,e[o])))}})),r};var e={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},i=/([astvzqmhlc])([^astvzqmhlc]*)/gi,n=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi},4732:(t,e,i)=>{"use strict";var n=i(8507);class r{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this._cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:n}=this._resizeTo;t=i,e=n}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}r.extension=n.Ag.Application;var s=i(4458),o=i(7309);class a{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,s.d.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?o.R.shared:new o.R,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}a.extension=n.Ag.Application,n.XO.add(r),n.XO.add(a)},9852:(t,e,i)=>{"use strict";var n=i(8507),r=i(4263),s=i(5101);class o{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=o.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new s.b,this.page=new s.b,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,n,r){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}var a=/iPhone/i,h=/iPod/i,l=/iPad/i,u=/\biOS-universal(?:.+)Mac\b/i,c=/\bAndroid(?:.+)Mobile\b/i,d=/Android/i,p=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,f=/Silk/i,g=/Windows Phone/i,m=/\bWindows(?:.+)ARM\b/i,x=/BlackBerry/i,_=/BB10/i,y=/Opera Mini/i,v=/\b(CriOS|Chrome)(?:.+)Mobile/i,b=/Mobile(?:.+)Firefox\b/i,T=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function w(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var i=e.userAgent,n=i.split("[FBAN");void 0!==n[1]&&(i=n[0]),void 0!==(n=i.split("Twitter"))[1]&&(i=n[0]);var r=function(t){return function(e){return e.test(t)}}(i),s={apple:{phone:r(a)&&!r(g),ipod:r(h),tablet:!r(a)&&(r(l)||T(e))&&!r(g),universal:r(u),device:(r(a)||r(h)||r(l)||r(u)||T(e))&&!r(g)},amazon:{phone:r(p),tablet:!r(p)&&r(f),device:r(p)||r(f)},android:{phone:!r(g)&&r(p)||!r(g)&&r(c),tablet:!r(g)&&!r(p)&&!r(c)&&(r(f)||r(d)),device:!r(g)&&(r(p)||r(f)||r(c)||r(d))||r(/\bokhttp\b/i)},windows:{phone:r(g),tablet:r(m),device:r(g)||r(m)},other:{blackberry:r(x),blackberry10:r(_),opera:r(y),firefox:r(b),chrome:r(v),device:r(x)||r(_)||r(y)||r(b)||r(v)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const S=(w.default??w)(globalThis.navigator);var P=i(9903);class M{constructor(t,e=S){this._mobileInfo=e,this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this._pool=[],this._renderId=0,this._children=[],this._androidUpdateCount=0,this._androidUpdateFrequency=500,this._hookDiv=null,(e.tablet||e.phone)&&this._createTouchHook();const i=document.createElement("div");i.style.width="100px",i.style.height="100px",i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.style.zIndex=2..toString(),this._div=i,this._renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}get hookDiv(){return this._hookDiv}_createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this._activate(),this._destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}_destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}_activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this._renderer.runners.postrender.add(this),this._renderer.view.canvas.parentNode?.appendChild(this._div))}_deactivate(){this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this._renderer.runners.postrender.remove(this),this._div.parentNode?.removeChild(this._div))}_updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this._addChild(t),t._renderId=this._renderId);const e=t.children;if(e)for(let t=0;t<e.length;t++)this._updateAccessibleObjects(e[t])}init(t){this.debug=t?.debug??this.debug,this._renderer.runners.postrender.remove(this)}postrender(){const t=performance.now();if(this._mobileInfo.android.device&&t<this._androidUpdateCount)return;if(this._androidUpdateCount=t+this._androidUpdateFrequency,!this._renderer.renderingToScreen||!this._renderer.view.canvas)return;this._renderer.lastObjectRendered&&this._updateAccessibleObjects(this._renderer.lastObjectRendered);const{x:e,y:i,width:n,height:r}=this._renderer.view.canvas.getBoundingClientRect(),{width:s,height:o,resolution:a}=this._renderer,h=n/s*a,l=r/o*a;let u=this._div;u.style.left=`${e}px`,u.style.top=`${i}px`,u.style.width=`${s}px`,u.style.height=`${o}px`;for(let t=0;t<this._children.length;t++){const e=this._children[t];if(e._renderId!==this._renderId)e._accessibleActive=!1,(0,P.d)(this._children,t,1),this._div.removeChild(e._accessibleDiv),this._pool.push(e._accessibleDiv),e._accessibleDiv=null,t--;else{u=e._accessibleDiv;let t=e.hitArea;const i=e.worldTransform;e.hitArea?(u.style.left=(i.tx+t.x*i.a)*h+"px",u.style.top=(i.ty+t.y*i.d)*l+"px",u.style.width=t.width*i.a*h+"px",u.style.height=t.height*i.d*l+"px"):(t=e.getBounds().rectangle,this._capHitArea(t),u.style.left=t.x*h+"px",u.style.top=t.y*l+"px",u.style.width=t.width*h+"px",u.style.height=t.height*l+"px",u.title!==e.accessibleTitle&&null!==e.accessibleTitle&&(u.title=e.accessibleTitle||""),u.getAttribute("aria-label")!==e.accessibleHint&&null!==e.accessibleHint&&u.setAttribute("aria-label",e.accessibleHint||"")),e.accessibleTitle===u.title&&e.tabIndex===u.tabIndex||(u.title=e.accessibleTitle||"",u.tabIndex=e.tabIndex,this.debug&&this._updateDebugHTML(u))}}this._renderId++}_updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}_capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:i}=this._renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}_addChild(t){let e=this._pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title=`container ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this._updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.container=t,this._children.push(t),this._div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{container:i}=t.target,n=this._renderer.events.rootBoundary,r=Object.assign(new o(n),{target:i});n.rootTarget=this._renderer.lastObjectRendered,e.forEach((t=>n.dispatchEvent(r,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this._activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this._deactivate()}destroy(){this._destroyTouchHook(),this._div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this._pool=null,this._children=null,this._renderer=null}}M.extension={type:[n.Ag.WebGLSystem,n.Ag.WebGPUSystem],name:"accessibility"},n.XO.add(M),r.mc.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,_renderId:-1}),i(4732);var E=i(4486),C=i(268),k=i(4458),A=i(7309);const B=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){!this._tickerAdded&&this.domElement&&(A.R.system.add(this._tickerUpdate,this,k.d.INTERACTION),this._tickerAdded=!0)}removeTickerListener(){this._tickerAdded&&(A.R.system.remove(this._tickerUpdate,this),this._tickerAdded=!1)}pointerMoved(){this._didMove=!0}_update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const t=this.events._rootPointerEvent;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,pointerId:t.pointerId}))}_tickerUpdate(t){this._deltaTime+=t.deltaTime,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this._update())}};class R extends o{constructor(){super(...arguments),this.client=new s.b,this.movement=new s.b,this.offset=new s.b,this.global=new s.b,this.screen=new s.b}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,n,r,s,o,a,h,l,u,c,d,p,f){throw new Error("Method not implemented.")}}class I extends R{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class F extends R{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}F.DOM_DELTA_PIXEL=0,F.DOM_DELTA_LINE=1,F.DOM_DELTA_PAGE=2;const z=new s.b,U=new s.b;class D{constructor(t){this.dispatch=new E.A,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let i=0,n=e.length;i<n;i++)e[i].fn(t);else(0,C.R)(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){B.pauseUpdate=!0;const i=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,z.set(t,e),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,r=i.length-1;n<r;n++)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let n=i.length-2;n>=0;n--)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this._allInteractiveElements){if(0===i.length)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(e)?e:[e];for(let e=i.length-1;e>=0;e--)n.forEach((n=>{t.currentTarget=i[e],this.notifyTarget(t,n)}))}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget&&t.parent;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,i,n,r,s=!1){let o=!1;if(this._interactivePrune(t))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(B.pauseUpdate=!1),t.interactiveChildren&&t.children){const a=t.children;for(let h=a.length-1;h>=0;h--){const l=a[h],u=this.hitTestMoveRecursive(l,this._isInteractive(e)?e:l.eventMode,i,n,r,s||r(t,i));if(u){if(u.length>0&&!u[u.length-1].parent)continue;const e=t.isInteractive();(u.length>0||e)&&(e&&this._allInteractiveElements.push(t),u.push(t)),0===this._hitElements.length&&(this._hitElements=u),o=!0}}}const a=this._isInteractive(e),h=t.isInteractive();return h&&h&&this._allInteractiveElements.push(t),s||this._hitElements.length>0?null:o?this._hitElements:a&&!r(t,i)&&n(t,i)?h?[t]:[]:null}hitTestRecursive(t,e,i,n,r){if(this._interactivePrune(t)||r(t,i))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(B.pauseUpdate=!1),t.interactiveChildren&&t.children){const s=t.children,o=i;for(let i=s.length-1;i>=0;i--){const a=s[i],h=this.hitTestRecursive(a,this._isInteractive(e)?e:a.eventMode,o,n,r);if(h){if(h.length>0&&!h[h.length-1].parent)continue;const e=t.isInteractive();return(h.length>0||e)&&h.push(t),h}}}const s=this._isInteractive(e),o=t.isInteractive();return s&&n(t,i)?o?[t]:[]:null}_isInteractive(t){return"static"===t||"dynamic"===t}_interactivePrune(t){return!(t&&t.visible&&t.renderable&&t.includeInBuild&&t.measurable)||"none"===t.eventMode||"passive"===t.eventMode&&!t.interactiveChildren}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,U),!t.hitArea.contains(U.x,U.y)))return!0;if(t.effects&&t.effects.length)for(let i=0;i<t.effects.length;i++){const n=t.effects[i];if(n.containsPoint&&!n.containsPoint(e,this.hitTestFn))return!0}return!1}hitTestFn(t,e){return!!t.hitArea||!!t?.containsPoint&&(t.worldTransform.applyInverse(e,U),t.containsPoint(U))}notifyTarget(t,e){if(!t.currentTarget.isInteractive())return;const i=`on${e=e??t.type}`;t.currentTarget[i]?.(t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this._notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this._notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof I))return void(0,C.R)("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof I))return void(0,C.R)("EventBoundary cannot map a non-pointer event as a pointer event");this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const i="mouse"===e.pointerType||"pen"===e.pointerType,n=this.trackingData(t.pointerId),r=this.findMountedTarget(n.overTargets);if(n.overTargets?.length>0&&r!==e.target){const n="mousemove"===t.type?"mouseout":"pointerout",s=this.createPointerEvent(t,n,r);if(this.dispatchEvent(s,"pointerout"),i&&this.dispatchEvent(s,"mouseout"),!e.composedPath().includes(r)){const n=this.createPointerEvent(t,"pointerleave",r);for(n.eventPhase=n.AT_TARGET;n.target&&!e.composedPath().includes(n.target);)n.currentTarget=n.target,this.notifyTarget(n),i&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;this.freeEvent(n)}this.freeEvent(s)}if(r!==e.target){const n="mousemove"===t.type?"mouseover":"pointerover",s=this.clonePointerEvent(e,n);this.dispatchEvent(s,"pointerover"),i&&this.dispatchEvent(s,"mouseover");let o=r?.parent;for(;o&&o!==this.rootTarget.parent&&o!==e.target;)o=o.parent;if(!o||o===this.rootTarget.parent){const t=this.clonePointerEvent(e,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==r&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),i&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(s)}const s=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?s.push("pointermove"):this.dispatchEvent(e,"pointermove"),o&&s.push("globalpointermove"),"touch"===e.pointerType&&(this.moveOnAll?s.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),o&&s.push("globaltouchmove")),i&&(this.moveOnAll?s.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),o&&s.push("globalmousemove"),this.cursor=e.target?.cursor),s.length>0&&this.all(e,s),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof I))return void(0,C.R)("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),n="mouse"===i.pointerType||"pen"===i.pointerType;this.dispatchEvent(i,"pointerover"),n&&this.dispatchEvent(i,"mouseover"),"mouse"===i.pointerType&&(this.cursor=i.target?.cursor);const r=this.clonePointerEvent(i,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),n&&this.notifyTarget(r,"mouseenter"),r.target=r.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(r)}mapPointerOut(t){if(!(t instanceof I))return void(0,C.R)("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId);if(e.overTargets){const i="mouse"===t.pointerType||"pen"===t.pointerType,n=this.findMountedTarget(e.overTargets),r=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(r),i&&this.dispatchEvent(r,"mouseout");const s=this.createPointerEvent(t,"pointerleave",n);for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),i&&this.notifyTarget(s,"mouseleave"),s.target=s.target.parent;e.overTargets=null,this.freeEvent(r),this.freeEvent(s)}this.cursor=null}mapPointerUp(t){if(!(t instanceof I))return void(0,C.R)("EventBoundary cannot map a non-pointer event as a pointer event");const e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),"touch"===i.pointerType)this.dispatchEvent(i,"touchend");else if("mouse"===i.pointerType||"pen"===i.pointerType){const t=2===i.button;this.dispatchEvent(i,t?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),r=this.findMountedTarget(n.pressTargetsByButton[t.button]);let s=r;if(r&&!i.composedPath().includes(r)){let e=r;for(;e&&!i.composedPath().includes(e);){if(i.currentTarget=e,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType)this.notifyTarget(i,"touchendoutside");else if("mouse"===i.pointerType||"pen"===i.pointerType){const t=2===i.button;this.notifyTarget(i,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete n.pressTargetsByButton[t.button],s=e}if(s){const r=this.clonePointerEvent(i,"click");r.target=s,r.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:r.target,timeStamp:e});const o=n.clicksByButton[t.button];if(o.target===r.target&&e-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=r.target,o.timeStamp=e,r.detail=o.clickCount,"mouse"===r.pointerType){const t=2===r.button;this.dispatchEvent(r,t?"rightclick":"click")}else"touch"===r.pointerType&&this.dispatchEvent(r,"tap");this.dispatchEvent(r,"pointertap"),this.freeEvent(r)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof I))return void(0,C.R)("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(i){let r=i;for(;r;)n.currentTarget=r,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType?this.notifyTarget(n,"touchendoutside"):"mouse"!==n.pointerType&&"pen"!==n.pointerType||this.notifyTarget(n,2===n.button?"rightupoutside":"mouseupoutside"),r=r.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof F))return void(0,C.R)("EventBoundary cannot map a non-wheel event as a wheel event");const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const n=this.allocateEvent(I);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=i??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],"string"==typeof e&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(F);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const i=this.allocateEvent(I);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof I&&e instanceof I&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof R&&e instanceof R&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}_notifyListeners(t,e){const i=t.currentTarget._events[e];if(i)if("fn"in i)i.once&&t.currentTarget.removeListener(e,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let n=0,r=i.length;n<r&&!t.propagationImmediatelyStopped;n++)i[n].once&&t.currentTarget.removeListener(e,i[n].fn,void 0,!0),i[n].fn.call(i[n].context,t)}}const O={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},L=class t{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new D(null),B.init(this),this.autoPreventDefault=!0,this._eventsAdded=!1,this._rootPointerEvent=new I(null),this._rootWheelEvent=new F(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...t.defaultEventFeatures},{set:(t,e,i)=>("globalMove"===e&&(this.rootBoundary.enableGlobalMoveEvents=i),t[e]=i,!0)}),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerUp=this._onPointerUp.bind(this),this._onPointerOverOut=this._onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{canvas:i,resolution:n}=this.renderer;this.setTargetElement(i),this.resolution=n,t._defaultEventMode=e.eventMode??"passive",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null,this._currentCursor=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this._currentCursor===t)return;this._currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this._rootPointerEvent}_onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this._normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let t=0,i=e.length;t<i;t++){const i=e[t],n=this._bootstrapEvent(this._rootPointerEvent,i);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}_onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,B.pointerMoved();const e=this._normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this._bootstrapEvent(this._rootPointerEvent,e[t]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}_onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const i=e!==this.domElement?"outside":"",n=this._normalizeToPointerData(t);for(let t=0,e=n.length;t<e;t++){const e=this._bootstrapEvent(this._rootPointerEvent,n[t]);e.type+=i,this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}_onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this._normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this._bootstrapEvent(this._rootPointerEvent,e[t]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this._removeEvents(),this.domElement=t,B.domElement=t,this._addEvents()}_addEvents(){if(this._eventsAdded||!this.domElement)return;B.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this._onPointerMove,!0),this.domElement.addEventListener("pointerdown",this._onPointerDown,!0),this.domElement.addEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this._onPointerOverOut,!0),globalThis.addEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this._onPointerMove,!0),this.domElement.addEventListener("mousedown",this._onPointerDown,!0),this.domElement.addEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this._onPointerOverOut,!0),globalThis.addEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this._onPointerDown,!0),this.domElement.addEventListener("touchend",this._onPointerUp,!0),this.domElement.addEventListener("touchmove",this._onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this._eventsAdded=!0}_removeEvents(){if(!this._eventsAdded||!this.domElement)return;B.removeTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction="")),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this._onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this._onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this._onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this._onPointerMove,!0),this.domElement.removeEventListener("mousedown",this._onPointerDown,!0),this.domElement.removeEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this._onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this._onPointerDown,!0),this.domElement.removeEventListener("touchend",this._onPointerUp,!0),this.domElement.removeEventListener("touchmove",this._onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this._eventsAdded=!1}mapPositionToPoint(t,e,i){const n=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},r=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*r,t.y=(i-n.top)*(this.domElement.height/n.height)*r}_normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,n=t.changedTouches.length;i<n;i++){const n=t.changedTouches[i];void 0===n.button&&(n.button=0),void 0===n.buttons&&(n.buttons=1),void 0===n.isPrimary&&(n.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===n.width&&(n.width=n.radiusX||1),void 0===n.height&&(n.height=n.radiusY||1),void 0===n.tiltX&&(n.tiltX=0),void 0===n.tiltY&&(n.tiltY=0),void 0===n.pointerType&&(n.pointerType="touch"),void 0===n.pointerId&&(n.pointerId=n.identifier||0),void 0===n.pressure&&(n.pressure=n.force||.5),void 0===n.twist&&(n.twist=0),void 0===n.tangentialPressure&&(n.tangentialPressure=0),void 0===n.layerX&&(n.layerX=n.offsetX=n.clientX),void 0===n.layerY&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&!(this.supportsPointerEvents&&t instanceof globalThis.PointerEvent)){const i=t;void 0===i.isPrimary&&(i.isPrimary=!0),void 0===i.width&&(i.width=1),void 0===i.height&&(i.height=1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="mouse"),void 0===i.pointerId&&(i.pointerId=1),void 0===i.pressure&&(i.pressure=.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this._rootWheelEvent;return this._transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}_bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this._transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=O[t.type]||t.type),t}_transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};L.extension={name:"events",type:[n.Ag.WebGLSystem,n.Ag.CanvasSystem,n.Ag.WebGPUSystem],priority:-1},L.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let W=L;const G={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,get interactive(){return"dynamic"===this.eventMode||"static"===this.eventMode},set interactive(t){this.eventMode=t?"static":"passive"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??W.defaultEventMode},set eventMode(t){this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,i){const n="boolean"==typeof i&&i||"object"==typeof i&&i.capture,r="object"==typeof i?i.signal:void 0,s="object"==typeof i&&!0===i.once,o="function"==typeof e?void 0:e;t=n?`${t}capture`:t;const a="function"==typeof e?e:e.handleEvent,h=this;r&&r.addEventListener("abort",(()=>{h.off(t,a,o)})),s?h.once(t,a,o):h.on(t,a,o)},removeEventListener(t,e,i){const n="function"==typeof e?void 0:e;t="boolean"==typeof i&&i||"object"==typeof i&&i.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,n)},dispatchEvent(t){if(!(t instanceof o))throw new Error("Container cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};n.XO.add(W),r.mc.mixin(G),i(6312),i(5753),i(8928),i(5285),i(6958),i(6607),i(7559),i(8723),i(7252),i(9935)},9935:(t,e,i)=>{"use strict";var n=i(8507);class r{constructor(t){this._renderer=t}push(t,e,i){this._renderer.renderPipes.batch.break(i),i.add({renderPipeId:"filter",canBundle:!1,action:"pushFilter",container:e,filterEffect:t})}pop(t,e,i){this._renderer.renderPipes.batch.break(i),i.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}execute(t){"pushFilter"===t.action?this._renderer.filter.push(t):"popFilter"===t.action&&this._renderer.filter.pop()}destroy(){this._renderer=null}}r.extension={type:[n.Ag.WebGLPipes,n.Ag.WebGPUPipes,n.Ag.CanvasPipes],name:"filter"};var s=i(9313),o=i(5101),a=i(3513),h=i(6011),l=i(5811),u=i(4492),c=i(2437),d=i(5099),p=i(9636),f=i(2208);const g=new s.u;function m(t,e){return e.clear(),x(t,e),e.isValid||e.set(0,0,0,0),t.renderGroup?e.applyMatrix(t.renderGroup.localTransform):e.applyMatrix(t.parentRenderGroup.worldTransform),e}function x(t,e){if(7!==t.localDisplayStatus||!t.measurable)return;const i=!!t.effects.length;let n=e;if((t.renderGroup||i)&&(n=f.o.get().clear()),t.boundsArea)e.addRect(t.boundsArea,t.worldTransform);else{if(t.renderPipeId){const e=t.bounds;n.addFrame(e.minX,e.minY,e.maxX,e.maxY,t.groupTransform)}const e=t.children;for(let t=0;t<e.length;t++)x(e[t],n)}if(i){let i=!1;for(let e=0;e<t.effects.length;e++)t.effects[e].addBounds&&(i||(i=!0,n.applyMatrix(t.parentRenderGroup.worldTransform)),t.effects[e].addBounds(n,!0));i&&(n.applyMatrix(t.parentRenderGroup.worldTransform.copyTo(g).invert()),e.addBounds(n,t.relativeGroupTransform)),e.addBounds(n),f.o.return(n)}else t.renderGroup&&(e.addBounds(n,t.relativeGroupTransform),f.o.return(n))}var _=i(268);const y=new h.V({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),location:0,format:"float32x2",stride:8,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])});class v{constructor(t){this._filterStackIndex=0,this._filterStack=[],this._filterGlobalUniforms=new l.k({uInputSize:{value:new Float32Array(4),type:"vec4<f32>"},uInputPixel:{value:new Float32Array(4),type:"vec4<f32>"},uInputClamp:{value:new Float32Array(4),type:"vec4<f32>"},uOutputFrame:{value:new Float32Array(4),type:"vec4<f32>"},uGlobalFrame:{value:new Float32Array(4),type:"vec4<f32>"},uOutputTexture:{value:new Float32Array(4),type:"vec4<f32>"}}),this._globalFilterBindGroup=new a.T({}),this.renderer=t}get activeBackTexture(){return this._activeFilterData?.backTexture}push(t){const e=this.renderer,i=t.filterEffect.filters;this._filterStack[this._filterStackIndex]||(this._filterStack[this._filterStackIndex]=this._getFilterData());const n=this._filterStack[this._filterStackIndex];if(this._filterStackIndex++,0===i.length)return void(n.skip=!0);const r=n.bounds;t.renderables?function(t,e){e.clear();const i=e.matrix;for(let i=0;i<t.length;i++){const n=t[i];n.globalDisplayStatus<7||(e.matrix=n.worldTransform,n.addBounds(e))}e.matrix=i}(t.renderables,r):t.filterEffect.filterArea?(r.clear(),r.addRect(t.filterEffect.filterArea),r.applyMatrix(t.container.worldTransform)):m(t.container,r);const s=e.renderTarget.renderTarget.colorTexture.source;let o=1/0,a=0,h=!0,l=!1,u=!1;for(let t=0;t<i.length;t++){const n=i[t];if(o=Math.min(o,"inherit"===n.resolution?s._resolution:n.resolution),a+=n.padding,"off"===n.antialias?h=!1:"inherit"===n.antialias&&h&&(h=s.antialias),!(n.compatibleRenderers&e.type)){u=!1;break}if(n.blendRequired&&!(e.backBuffer?.useBackBuffer??1)){(0,_.R)("Blend filter requires backBuffer on WebGL renderer to be enabled. Set `useBackBuffer: true` in the renderer options."),u=!1;break}u=n.enabled||u,l=l||n.blendRequired}if(!u)return void(n.skip=!0);const d=e.renderTarget.rootViewPort;r.scale(o).fitBounds(0,d.width,0,d.height).scale(1/o).pad(a).ceil(),r.isPositive?(n.skip=!1,n.bounds=r,n.blendRequired=l,n.container=t.container,n.filterEffect=t.filterEffect,n.previousRenderSurface=e.renderTarget.renderSurface,n.inputTexture=c.W.getOptimalTexture(r.width,r.height,o,h),e.renderTarget.bind(n.inputTexture,!0),e.globalUniforms.push({offset:r})):n.skip=!0}pop(){const t=this.renderer;this._filterStackIndex--;const e=this._filterStack[this._filterStackIndex];if(e.skip)return;this._activeFilterData=e;const i=e.inputTexture,n=e.bounds;let r=u.g.EMPTY;if(t.renderTarget.finishRenderPass(),e.blendRequired){const i=this._filterStackIndex>0?this._filterStack[this._filterStackIndex-1].bounds:null,s=t.renderTarget.getRenderTarget(e.previousRenderSurface);r=this.getBackTexture(s,n,i)}e.backTexture=r;const s=e.filterEffect.filters;if(this._globalFilterBindGroup.setResource(i.source.style,2),this._globalFilterBindGroup.setResource(r.source,3),t.globalUniforms.pop(),1===s.length)s[0].apply(this,i,e.previousRenderSurface,!1),c.W.returnTexture(i);else{let t=e.inputTexture,i=c.W.getOptimalTexture(n.width,n.height,t.source._resolution,!1),r=0;for(r=0;r<s.length-1;++r){s[r].apply(this,t,i,!0);const e=t;t=i,i=e}s[r].apply(this,t,e.previousRenderSurface,!1),c.W.returnTexture(t),c.W.returnTexture(i)}e.blendRequired&&c.W.returnTexture(r)}getBackTexture(t,e,i){const n=t.colorTexture.source._resolution,r=c.W.getOptimalTexture(e.width,e.height,n,!1);let s=e.minX,o=e.minY;i&&(s-=i.minX,o-=i.minY),s=Math.floor(s*n),o=Math.floor(o*n);const a=Math.ceil(e.width*n),h=Math.ceil(e.height*n);return this.renderer.renderTarget.copyToTexture(t,r,{x:s,y:o},{width:a,height:h},{x:0,y:0}),r}applyFilter(t,e,i,n){const r=this.renderer,s=this._filterStack[this._filterStackIndex],a=s.bounds,h=o.b.shared,l=s.previousRenderSurface===i;let c=this.renderer.renderTarget.rootRenderTarget.colorTexture.source._resolution,p=this._filterStackIndex-1;for(;p>0&&this._filterStack[p].skip;)--p;p>0&&(c=this._filterStack[p].inputTexture.source._resolution);const f=this._filterGlobalUniforms,g=f.uniforms,m=g.uOutputFrame,x=g.uInputSize,_=g.uInputPixel,v=g.uInputClamp,b=g.uGlobalFrame,T=g.uOutputTexture;if(l){let t=this._filterStackIndex;for(;t>0;){t--;const e=this._filterStack[this._filterStackIndex-1];if(!e.skip){h.x=e.bounds.minX,h.y=e.bounds.minY;break}}m[0]=a.minX-h.x,m[1]=a.minY-h.y}else m[0]=0,m[1]=0;m[2]=e.frame.width,m[3]=e.frame.height,x[0]=e.source.width,x[1]=e.source.height,x[2]=1/x[0],x[3]=1/x[1],_[0]=e.source.pixelWidth,_[1]=e.source.pixelHeight,_[2]=1/_[0],_[3]=1/_[1],v[0]=.5*_[2],v[1]=.5*_[3],v[2]=e.frame.width*x[2]-.5*_[2],v[3]=e.frame.height*x[3]-.5*_[3];const w=this.renderer.renderTarget.rootRenderTarget.colorTexture;b[0]=h.x*c,b[1]=h.y*c,b[2]=w.source.width*c,b[3]=w.source.height*c;const S=this.renderer.renderTarget.getRenderTarget(i);if(r.renderTarget.bind(i,!!n),i instanceof u.g?(T[0]=i.frame.width,T[1]=i.frame.height):(T[0]=S.width,T[1]=S.height),T[2]=S.isRoot?-1:1,f.update(),r.renderPipes.uniformBatch){const t=r.renderPipes.uniformBatch.getUboResource(f);this._globalFilterBindGroup.setResource(t,0)}else this._globalFilterBindGroup.setResource(f,0);this._globalFilterBindGroup.setResource(e.source,1),this._globalFilterBindGroup.setResource(e.source.style,2),t.groups[0]=this._globalFilterBindGroup,r.encoder.draw({geometry:y,shader:t,state:t._state,topology:"triangle-list"}),r.type===d.W.WEBGL&&r.renderTarget.finishRenderPass()}_getFilterData(){return{skip:!1,inputTexture:null,bounds:new p.c,container:null,filterEffect:null,blendRequired:!1,previousRenderSurface:null}}calculateSpriteMatrix(t,e){const i=this._activeFilterData,n=t.set(i.inputTexture._source.width,0,0,i.inputTexture._source.height,i.bounds.minX,i.bounds.minY),r=e.worldTransform.copyTo(s.u.shared);return r.invert(),n.prepend(r),n.scale(1/e.texture.frame.width,1/e.texture.frame.height),n.translate(e.anchor.x,e.anchor.y),n}}v.extension={type:[n.Ag.WebGLSystem,n.Ag.WebGPUSystem],name:"filter"},n.XO.add(v),n.XO.add(r)},6563:(t,e,i)=>{"use strict";i.d(e,{a:()=>a});var n=i(3804);const r=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function s(t){let e="";for(let i=0;i<t;++i)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(test == ${i}.0){}`);return e}let o=null;function a(){if(o)return o;const t=(0,n.W)();return o=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),o=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const i=e.createShader(e.FRAGMENT_SHADER);for(;;){const n=r.replace(/%forloop%/gi,s(t));if(e.shaderSource(i,n),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))break;t=t/2|0}return t}(o,t),o}},341:(t,e,i)=>{"use strict";i.d(e,{w:()=>a});var n=i(3513),r=i(4492),s=i(6563);const o={};function a(t,e){let i=0;for(let n=0;n<e;n++)i=31*i+t[n].uid>>>0;return o[i]||function(t,e,i){const a={};let l=0;h||(h=(0,s.a)());for(let i=0;i<h;i++){const n=i<e?t[i]:r.g.EMPTY.source;a[l++]=n.source,a[l++]=n.style}const u=new n.T(a);return o[i]=u,u}(t,e,i)}let h=0},1617:(t,e,i)=>{"use strict";i.d(e,{J:()=>h});var n=i(949),r=i(1132),s=i(6011);const o=new Float32Array(1),a=new Uint32Array(1);class h extends s.V{constructor(){const t=new n.h({data:o,label:"attribute-batch-buffer",usage:r.S.VERTEX|r.S.COPY_DST,shrinkToFit:!1});super({attributes:{aPosition:{buffer:t,format:"float32x2",stride:24,offset:0,location:1},aUV:{buffer:t,format:"float32x2",stride:24,offset:8,location:3},aColor:{buffer:t,format:"unorm8x4",stride:24,offset:16,location:0},aTextureIdAndRound:{buffer:t,format:"uint16x2",stride:24,offset:20,location:2}},indexBuffer:new n.h({data:a,label:"index-batch-buffer",usage:r.S.INDEX|r.S.COPY_DST,shrinkToFit:!1})})}}},5130:(t,e,i)=>{"use strict";i.d(e,{i:()=>m});var n=i(133);class r{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}var s=i(6736),o=i(8639),a=i(6563);class h{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}class l{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new h,this.blendMode="normal",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const u=[];let c=0;function d(){return c>0?u[--c]:new l}function p(t){u[c++]=t}let f=0;const g=class t{constructor(e={}){this.uid=(0,n.L)("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._vertexSize=6,this._elements=[],e={...t.defaultOptions,...e};const{vertexSize:i,indexSize:s}=e;this.attributeBuffer=new r(i*this._vertexSize*4),this.indexBuffer=new Uint16Array(s),this._maxTextures=(0,a.a)()}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)p(this.batches[t]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t.indexStart=this.indexSize,t.location=this.attributeSize,t.batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.vertexSize*this._vertexSize}checkAndUpdateTexture(t,e){const i=t.batch.textures.ids[e._source.uid];return!(!i&&0!==i||(t.textureId=i,t.texture=e,0))}updateElement(t){this.dirty=!0,t.packAttributes(this.attributeBuffer.float32View,this.attributeBuffer.uint32View,t.location,t.textureId)}break(t){const e=this._elements;if(!e[this.elementStart])return;let i=d(),n=i.textures;n.clear();const r=e[this.elementStart];let s=(0,o.i)(r.blendMode,r.texture._source);4*this.attributeSize>this.attributeBuffer.size&&this._resizeAttributeBuffer(4*this.attributeSize),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const a=this.attributeBuffer.float32View,h=this.attributeBuffer.uint32View,l=this.indexBuffer;let u=this._batchIndexSize,c=this._batchIndexStart,p="startBatch";const g=this._maxTextures;for(let r=this.elementStart;r<this.elementSize;++r){const m=e[r];e[r]=null;const x=m.texture._source,_=(0,o.i)(m.blendMode,x),y=s!==_;x._batchTick!==f||y?(x._batchTick=f,(n.count>=g||y)&&(this._finishBatch(i,c,u-c,n,s,t,p),p="renderBatch",c=u,s=_,i=d(),n=i.textures,n.clear(),++f),m.textureId=x._textureBindLocation=n.count,n.ids[x.uid]=n.count,n.textures[n.count++]=x,m.batch=i,u+=m.indexSize,m.packAttributes(a,h,m.location,m.textureId),m.packIndex(l,m.indexStart,m.location/this._vertexSize)):(m.textureId=x._textureBindLocation,u+=m.indexSize,m.packAttributes(a,h,m.location,m.textureId),m.packIndex(l,m.indexStart,m.location/this._vertexSize),m.batch=i)}n.count>0&&(this._finishBatch(i,c,u-c,n,s,t,p),c=u,++f),this.elementStart=this.elementSize,this._batchIndexStart=c,this._batchIndexSize=u}_finishBatch(t,e,i,n,r,s,o){t.gpuBindGroup=null,t.bindGroup=null,t.action=o,t.batcher=this,t.textures=n,t.blendMode=r,t.start=e,t.size=i,++f,this.batches[this.batchIndex++]=t,s.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){4*t<=this.attributeBuffer.size||this._resizeAttributeBuffer(4*t)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const e=Math.max(t,2*this.attributeBuffer.size),i=new r(e);(0,s.W)(this.attributeBuffer.rawBinaryData,i.rawBinaryData),this.attributeBuffer=i}_resizeIndexBuffer(t){const e=this.indexBuffer;let i=Math.max(t,1.5*e.length);i+=i%2;const n=i>65535?new Uint32Array(i):new Uint16Array(i);if(n.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(let t=0;t<e.length;t++)n[t]=e[t];else(0,s.W)(e.buffer,n.buffer);this.indexBuffer=n}destroy(){for(let t=0;t<this.batches.length;t++)p(this.batches[t]);this.batches=null;for(let t=0;t<this._elements.length;t++)this._elements[t].batch=null;this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}};g.defaultOptions={vertexSize:4,indexSize:6};let m=g},5611:(t,e,i)=>{"use strict";i.d(e,{I:()=>M,v:()=>P});var n=i(9113),r=i(3012),s=i(268);function o(t,e,i){if(t)for(const n in t){const r=e[n.toLocaleLowerCase()];if(r){let e=t[n];"header"===n&&(e=e.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),i&&r.push(`//----${i}----//`),r.push(e)}else(0,s.R)(`${n} placement hook does not exist in shader`)}}const a=/\{\{(.*?)\}\}/g;function h(t){const e={};return(t.match(a)?.map((t=>t.replace(/[{()}]/g,"")))??[]).forEach((t=>{e[t]=[]})),e}function l(t,e){let i;const n=/@in\s+([^;]+);/g;for(;null!==(i=n.exec(t));)e.push(i[1])}function u(t,e,i=!1){const n=[];l(e,n),t.forEach((t=>{t.header&&l(t.header,n)}));const r=n;i&&r.sort();const s=r.map(((t,e)=>`       @location(${e}) ${t},`)).join("\n");let o=e.replace(/@in\s+[^;]+;\s*/g,"");return o=o.replace("{{in}}",`\n${s}\n`),o}function c(t,e){let i;const n=/@out\s+([^;]+);/g;for(;null!==(i=n.exec(t));)e.push(i[1])}function d(t,e){let i=t;for(const t in e){const n=e[t];i=n.join("\n").length?i.replace(`{{${t}}}`,`//-----${t} START-----//\n${n.join("\n")}\n//----${t} FINISH----//`):i.replace(`{{${t}}}`,"")}return i}const p=Object.create(null),f=new Map;let g=0;function m({template:t,bits:e}){const i=x(t,e);return p[i]||(p[i]=_(t.vertex,t.fragment,e)),p[i]}function x(t,e){return e.map((t=>(f.has(t)||f.set(t,g++),f.get(t)))).sort(((t,e)=>t-e)).join("-")+t.vertex+t.fragment}function _(t,e,i){const n=h(t),r=h(e);return i.forEach((t=>{o(t.vertex,n,t.name),o(t.fragment,r,t.name)})),{vertex:d(t,n),fragment:d(e,r)}}const y="\n    @in aPosition: vec2<f32>;\n    @in aUV: vec2<f32>;\n\n    @out @builtin(position) vPosition: vec4<f32>;\n    @out vUV : vec2<f32>;\n    @out vColor : vec4<f32>;\n\n    {{header}}\n\n    struct VSOutput {\n        {{struct}}\n    };\n\n    @vertex\n    fn main( {{in}} ) -> VSOutput {\n\n        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;\n        var modelMatrix = mat3x3<f32>(\n            1.0, 0.0, 0.0,\n            0.0, 1.0, 0.0,\n            0.0, 0.0, 1.0\n          );\n        var position = aPosition;\n        var uv = aUV;\n\n        {{start}}\n        \n        vColor = vec4<f32>(1., 1., 1., 1.);\n\n        {{main}}\n\n        vUV = uv;\n\n        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;\n\n        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);\n       \n        vColor *= globalUniforms.uWorldColorAlpha;\n\n        {{end}}\n\n        {{return}}\n    };\n",v="\n    @in vUV : vec2<f32>;\n    @in vColor : vec4<f32>;\n   \n    {{header}}\n\n    @fragment\n    fn main(\n        {{in}}\n      ) -> @location(0) vec4<f32> {\n        \n        {{start}}\n\n        var outColor:vec4<f32>;\n      \n        {{main}}\n        \n        return outColor * vColor;\n      };\n",b="\n    in vec2 aPosition;\n    in vec2 aUV;\n\n    out vec4 vColor;\n    out vec2 vUV;\n\n    {{header}}\n\n    void main(void){\n\n        mat3 worldTransformMatrix = uWorldTransformMatrix;\n        mat3 modelMatrix = mat3(\n            1.0, 0.0, 0.0,\n            0.0, 1.0, 0.0,\n            0.0, 0.0, 1.0\n          );\n        vec2 position = aPosition;\n        vec2 uv = aUV;\n        \n        {{start}}\n        \n        vColor = vec4(1.);\n        \n        {{main}}\n        \n        vUV = uv;\n        \n        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;\n\n        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n\n        vColor *= uWorldColorAlpha;\n\n        {{end}}\n    }\n",T="\n   \n    in vec4 vColor;\n    in vec2 vUV;\n\n    out vec4 finalColor;\n\n    {{header}}\n\n    void main(void) {\n        \n        {{start}}\n\n        vec4 outColor;\n      \n        {{main}}\n        \n        finalColor = outColor * vColor;\n    }\n",w={name:"global-uniforms-bit",vertex:{header:"\n        struct GlobalUniforms {\n            uProjectionMatrix:mat3x3<f32>,\n            uWorldTransformMatrix:mat3x3<f32>,\n            uWorldColorAlpha: vec4<f32>,\n            uResolution: vec2<f32>,\n        }\n\n        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;\n        "}},S={name:"global-uniforms-bit",vertex:{header:"\n          uniform mat3 uProjectionMatrix;\n          uniform mat3 uWorldTransformMatrix;\n          uniform vec4 uWorldColorAlpha;\n          uniform vec2 uResolution;\n        "}};function P({bits:t,name:e}){const i=function({template:t,bits:e}){const i=x(t,e);if(p[i])return p[i];const{vertex:n,fragment:r}=function(t,e){const i=e.map((t=>t.vertex)).filter((t=>!!t)),n=e.map((t=>t.fragment)).filter((t=>!!t));let r=u(i,t.vertex,!0);return r=function(t,e){const i=[];c(e,i),t.forEach((t=>{t.header&&c(t.header,i)}));let n=0;const r=i.sort().map((t=>t.indexOf("builtin")>-1?t:`@location(${n++}) ${t}`)).join(",\n"),s=i.sort().map((t=>{return`       var ${e=t,e.replace(/@.*?\s+/g,"")};`;var e})).join("\n"),o=`return VSOutput(\n                ${i.sort().map((t=>` ${function(t){const e=/\b(\w+)\s*:/g.exec(t);return e?e[1]:""}(t)}`)).join(",\n")});`;let a=e.replace(/@out\s+[^;]+;\s*/g,"");return a=a.replace("{{struct}}",`\n${r}\n`),a=a.replace("{{start}}",`\n${s}\n`),a=a.replace("{{return}}",`\n${o}\n`),a}(i,r),{vertex:r,fragment:u(n,t.fragment,!0)}}(t,e);return p[i]=_(n,r,e),p[i]}({template:{fragment:v,vertex:y},bits:[w,...t]});return r.B.from({name:e,vertex:{source:i.vertex,entryPoint:"main"},fragment:{source:i.fragment,entryPoint:"main"}})}function M({bits:t,name:e}){return new n.M({name:e,...m({template:{vertex:b,fragment:T},bits:[S,...t]})})}},4459:(t,e,i)=>{"use strict";i.d(e,{F:()=>n,a:()=>r});const n={name:"color-bit",vertex:{header:"\n            @in aColor: vec4<f32>;\n        ",main:"\n            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);\n        "}},r={name:"color-bit",vertex:{header:"\n            in vec4 aColor;\n        ",main:"\n            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);\n        "}}},4e3:(t,e,i)=>{"use strict";i.d(e,{P:()=>l,_:()=>o});const n={};function r(t){const e=[];if(1===t)e.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),e.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let i=0;for(let n=0;n<t;n++)e.push(`@group(1) @binding(${i++}) var textureSource${n+1}: texture_2d<f32>;`),e.push(`@group(1) @binding(${i++}) var textureSampler${n+1}: sampler;`)}return e.join("\n")}function s(t){const e=[];if(1===t)e.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{e.push("switch vTextureId {");for(let i=0;i<t;i++)i===t-1?e.push("  default:{"):e.push(`  case ${i}:{`),e.push(`      outColor = textureSampleGrad(textureSource${i+1}, textureSampler${i+1}, vUV, uvDx, uvDy);`),e.push("      break;}");e.push("}")}return e.join("\n")}function o(t){return n[t]||(n[t]={name:"texture-batch-bit",vertex:{header:"\n                @in aTextureIdAndRound: vec2<u32>;\n                @out @interpolate(flat) vTextureId : u32;\n            ",main:"\n                vTextureId = aTextureIdAndRound.y;\n            ",end:"\n                if(aTextureIdAndRound.x == 1)\n                {\n                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n                }\n            "},fragment:{header:`\n                @in @interpolate(flat) vTextureId: u32;\n\n                ${r(t)}\n            `,main:`\n                var uvDx = dpdx(vUV);\n                var uvDy = dpdy(vUV);\n\n                ${s(t)}\n            `}}),n[t]}const a={};function h(t){const e=[];for(let i=0;i<t;i++)i>0&&e.push("else"),i<t-1&&e.push(`if(vTextureId < ${i}.5)`),e.push("{"),e.push(`\toutColor = texture(uTextures[${i}], vUV);`),e.push("}");return e.join("\n")}function l(t){return a[t]||(a[t]={name:"texture-batch-bit",vertex:{header:"\n                in vec2 aTextureIdAndRound;\n                out float vTextureId;\n\n            ",main:"\n                vTextureId = aTextureIdAndRound.y;\n            ",end:"\n                if(aTextureIdAndRound.x == 1.)\n                {\n                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n                }\n            "},fragment:{header:`\n                in float vTextureId;\n\n                uniform sampler2D uTextures[${t}];\n\n            `,main:`\n\n                ${h(t)}\n            `}}),a[t]}},2067:(t,e,i)=>{"use strict";i.d(e,{Ls:()=>n,_Q:()=>r,mA:()=>s});const n={name:"local-uniform-bit",vertex:{header:"\n\n            struct LocalUniforms {\n                uTransformMatrix:mat3x3<f32>,\n                uColor:vec4<f32>,\n                uRound:f32,\n            }\n\n            @group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "}},r={...n,vertex:{...n.vertex,header:n.vertex.header.replace("group(1)","group(2)")}},s={name:"local-uniform-bit",vertex:{header:"\n\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix = uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "}}},6665:(t,e,i)=>{"use strict";i.d(e,{b:()=>n,m:()=>r});const n={name:"round-pixels-bit",vertex:{header:"\n            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32> \n            {\n                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n            }\n        "}},r={name:"round-pixels-bit",vertex:{header:"   \n            vec2 roundPixels(vec2 position, vec2 targetSize)\n            {       \n                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n            }\n        "}}},9113:(t,e,i)=>{"use strict";i.d(e,{M:()=>d});var n=i(7952),r=i(3804);let s;function o(){if(!s){s="mediump";const t=(0,r.W)();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);s=e.precision?"highp":"mediump"}}return s}const a={},h={},l={stripVersion:function(t,e){return e?t.replace("#version 300 es",""):t},ensurePrecision:function(t,e,i){const n=i?e.maxSupportedFragmentPrecision:e.maxSupportedVertexPrecision;if("precision"!==t.substring(0,9)){let r=i?e.requestedFragmentPrecision:e.requestedVertexPrecision;return"highp"===r&&"highp"!==n&&(r="mediump"),`precision ${r} float;\n${t}`}return"highp"!==n&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t},addProgramDefines:function(t,e,i){return e?t:i?`\n        \n        #ifdef GL_ES // This checks if it is WebGL1\n        #define in varying\n        #define finalColor gl_FragColor\n        #define texture texture2D\n        #endif\n        ${t=t.replace("out vec4 finalColor;","")}\n        `:`\n        \n        #ifdef GL_ES // This checks if it is WebGL1\n        #define in attribute\n        #define out varying\n        #endif\n        ${t}\n        `},setProgramName:function(t,{name:e="pixi-program"},i=!0){e=e.replace(/\s+/g,"-");const n=i?a:h;return n[e+=i?"-fragment":"-vertex"]?(n[e]++,e+=`-${n[e]}`):n[e]=1,-1!==t.indexOf("#define SHADER_NAME")?t:`#define SHADER_NAME ${e}\n${t}`},insertVersion:function(t,e){return e?`#version 300 es\n${t}`:t}},u=Object.create(null),c=class t{constructor(e){const i=-1!==(e={...t.defaultOptions,...e}).fragment.indexOf("#version 300 es"),r={stripVersion:i,ensurePrecision:{requestedFragmentPrecision:e.preferredFragmentPrecision,requestedVertexPrecision:e.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:o()},setProgramName:{name:e.name},addProgramDefines:i,insertVersion:i};let s=e.fragment,a=e.vertex;Object.keys(l).forEach((t=>{const e=r[t];s=l[t](s,e,!0),a=l[t](a,e,!1)})),this.fragment=s,this.vertex=a,this._key=(0,n.X)(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null}static from(e){const i=`${e.vertex}:${e.fragment}`;return u[i]||(u[i]=new t(e)),u[i]}};c.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let d=c},6040:(t,e,i)=>{"use strict";i.d(e,{n:()=>s});var n=i(5811);const r={};function s(t){let e=r[t];if(e)return e;const i=new Int32Array(t);for(let e=0;e<t;e++)i[e]=e;return e=r[t]=new n.k({uTextures:{value:i,type:"i32",size:t}},{isStatic:!0}),e}},3804:(t,e,i)=>{"use strict";i.d(e,{W:()=>s});var n=i(1761);let r;function s(){if(!r||r?.isContextLost()){const t=n.e.get().createCanvas();r=t.getContext("webgl",{})}return r}},3513:(t,e,i)=>{"use strict";i.d(e,{T:()=>n});class n{constructor(t){this.resources=Object.create(null),this._dirty=!0;let e=0;for(const i in t){const n=t[i];this.setResource(n,e++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const t=[];let e=0;for(const i in this.resources)t[e++]=this.resources[i]._resourceId;this._key=t.join("|")}setResource(t,e){const i=this.resources[e];t!==i&&(i&&t.off?.("change",this.onResourceChange,this),t.on?.("change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t){const e=this.resources;for(const i in e)e[i]._touched=t}destroy(){const t=this.resources;for(const e in t){const i=t[e];i.off?.("change",this.onResourceChange,this)}this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){const e=this.resources;for(const i in e)e[i]===t&&(e[i]=null)}else this._updateKey()}}},3012:(t,e,i)=>{"use strict";i.d(e,{B:()=>l});var n=i(7952),r=i(8306);const s={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function o(t){const e=/@group\((\d+)\)/,i=/@binding\((\d+)\)/,n=/var(<[^>]+>)? (\w+)/,r=/:\s*(\w+)/,s=/(\w+)\s*:\s*([\w\<\>]+)/g,o=/struct\s+(\w+)/,a=t.match(/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g)?.map((t=>({group:parseInt(t.match(e)[1],10),binding:parseInt(t.match(i)[1],10),name:t.match(n)[2],isUniform:"<uniform>"===t.match(n)[1],type:t.match(r)[1]})));if(!a)return{groups:[],structs:[]};const h=t.match(/struct\s+(\w+)\s*{([^}]+)}/g)?.map((t=>{const e=t.match(o)[1],i=t.match(s).reduce(((t,e)=>{const[i,n]=e.split(":");return t[i.trim()]=n.trim(),t}),{});return i?{name:e,members:i}:null})).filter((({name:t})=>a.some((e=>e.type===t))))??[];return{groups:a,structs:h}}var a=(t=>(t[t.VERTEX=1]="VERTEX",t[t.FRAGMENT=2]="FRAGMENT",t[t.COMPUTE=4]="COMPUTE",t))(a||{});const h=Object.create(null);class l{constructor(t){this._layoutKey=0;const{fragment:e,vertex:i,layout:n,gpuLayout:r,name:s}=t;if(this.name=s,this.fragment=e,this.vertex=i,e.source===i.source){const t=o(e.source);this.structsAndGroups=t}else{const t=o(i.source),n=o(e.source);this.structsAndGroups=function(t,e){const i=new Set,n=new Set;return{structs:[...t.structs,...e.structs].filter((t=>!i.has(t.name)&&(i.add(t.name),!0))),groups:[...t.groups,...e.groups].filter((t=>{const e=`${t.name}-${t.binding}`;return!n.has(e)&&(n.add(e),!0)}))}}(t,n)}this.layout=n??function({groups:t}){const e=[];for(let i=0;i<t.length;i++){const n=t[i];e[n.group]||(e[n.group]={}),e[n.group][n.name]=n.binding}return e}(this.structsAndGroups),this.gpuLayout=r??function({groups:t}){const e=[];for(let i=0;i<t.length;i++){const n=t[i];e[n.group]||(e[n.group]=[]),n.isUniform?e[n.group].push({binding:n.binding,visibility:a.VERTEX|a.FRAGMENT,buffer:{type:"uniform"}}):"sampler"===n.type?e[n.group].push({binding:n.binding,visibility:a.FRAGMENT,sampler:{type:"filtering"}}):"texture_2d"===n.type&&e[n.group].push({binding:n.binding,visibility:a.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return e}(this.structsAndGroups),this.autoAssignGlobalUniforms=!(void 0===this.layout[0]?.globalUniforms),this.autoAssignLocalUniforms=!(void 0===this.layout[1]?.localUniforms),this._generateProgramKey()}_generateProgramKey(){const{vertex:t,fragment:e}=this,i=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=(0,n.X)(i,"program")}get attributeData(){return this._attributeData??(this._attributeData=function({source:t,entryPoint:e}){const i={},n=t.indexOf(`fn ${e}`);if(-1!==n){const e=t.indexOf("->",n);if(-1!==e){const o=t.substring(n,e),a=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let h;for(;null!==(h=a.exec(o));){const t=s[h[3]]??"float32";i[h[2]]={location:parseInt(h[1],10),format:t,stride:(0,r.m)(t).stride,offset:0,instance:!1,start:0}}}}return i}(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null}static from(t){const e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return h[e]||(h[e]=new l(t)),h[e]}}},949:(t,e,i)=>{"use strict";i.d(e,{h:()=>o});var n=i(4486),r=i(133),s=i(1132);class o extends n.A{constructor(t){let{data:e,size:i}=t;const{usage:n,label:s,shrinkToFit:o}=t;super(),this.uid=(0,r.L)("buffer"),this._resourceType="buffer",this._resourceId=(0,r.L)("resource"),this._touched=0,this._updateID=1,this.shrinkToFit=!0,this.destroyed=!1,e instanceof Array&&(e=new Float32Array(e)),this._data=e,i=i??e?.byteLength;const a=!!e;this.descriptor={size:i,usage:n,mappedAtCreation:a,label:s},this.shrinkToFit=o??!0}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get static(){return!!(this.descriptor.usage&s.S.STATIC)}set static(t){t?this.descriptor.usage|=s.S.STATIC:this.descriptor.usage&=~s.S.STATIC}setDataWithSize(t,e,i){if(this._updateID++,this._updateSize=e*t.BYTES_PER_ELEMENT,this._data===t)return void(i&&this.emit("update",this));const n=this._data;this._data=t,n.length===t.length||!this.shrinkToFit&&t.byteLength<n.byteLength?i&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=(0,r.L)("resource"),this.emit("change",this))}update(t){this._updateSize=t??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}},1132:(t,e,i)=>{"use strict";i.d(e,{S:()=>n});var n=(t=>(t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE",t[t.STATIC=1024]="STATIC",t))(n||{})},6736:(t,e,i)=>{"use strict";function n(t,e){const i=t.byteLength/8|0,n=new Float64Array(t,0,i);new Float64Array(e,0,i).set(n);const r=t.byteLength-8*i;if(r>0){const n=new Uint8Array(t,8*i,r);new Uint8Array(e,8*i,r).set(n)}}i.d(e,{W:()=>n})},6011:(t,e,i)=>{"use strict";i.d(e,{V:()=>u});var n=i(4486),r=i(9636),s=i(133),o=i(949),a=i(1132);function h(t,e){if(!(t instanceof o.h)){let i=e?a.S.INDEX:a.S.VERTEX;t instanceof Array&&(e?(t=new Uint32Array(t),i=a.S.INDEX|a.S.COPY_DST):(t=new Float32Array(t),i=a.S.VERTEX|a.S.COPY_DST)),t=new o.h({data:t,label:e?"index-mesh-buffer":"vertex-mesh-buffer",usage:i})}return t}function l(t){return(t instanceof o.h||Array.isArray(t)||t.BYTES_PER_ELEMENT)&&(t={buffer:t}),t.buffer=h(t.buffer,!1),t}class u extends n.A{constructor(t){const{attributes:e,indexBuffer:i,topology:n}=t;super(),this.uid=(0,s.L)("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new r.c,this._boundsDirty=!0,this.attributes=e,this.buffers=[],this.instanceCount=t.instanceCount||1;for(const t in e){const i=e[t]=l(e[t]);-1===this.buffers.indexOf(i.buffer)&&(this.buffers.push(i.buffer),i.buffer.on("update",this.onBufferUpdate,this),i.buffer.on("change",this.onBufferUpdate,this))}i&&(this.indexBuffer=h(i,!0),this.buffers.push(this.indexBuffer)),this.topology=n||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,function(t,e,i){const n=t.getAttribute("aPosition");if(!n)return i.minX=0,i.minY=0,i.maxX=0,i.maxY=0,i;const r=n.buffer.data;let s=1/0,o=1/0,a=-1/0,h=-1/0;const l=r.BYTES_PER_ELEMENT,u=(n.offset||0)/l,c=(n.stride||8)/l;for(let t=u;t<r.length;t+=c){const e=r[t],i=r[t+1];e>a&&(a=e),i>h&&(h=i),e<s&&(s=e),i<o&&(o=i)}return i.minX=s,i.minY=o,i.maxX=a,i.maxY=h,i}(this,0,this._bounds)):this._bounds}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach((t=>t.destroy())),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}},8306:(t,e,i)=>{"use strict";i.d(e,{m:()=>r});const n={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function r(t){return n[t]??n.float32}},8475:(t,e,i)=>{"use strict";i.d(e,{M:()=>l});var n=i(4486),r=i(9113),s=i(3513),o=i(3012),a=i(5099),h=i(5811);class l extends n.A{constructor(t){super(),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:e,glProgram:i,groups:n,resources:r,compatibleRenderers:o,groupMap:l}=t;this.gpuProgram=e,this.glProgram=i,void 0===o&&(o=0,e&&(o|=a.W.WEBGPU),i&&(o|=a.W.WEBGL)),this.compatibleRenderers=o;const u={};if(r||n||(r={}),r&&n)throw new Error("[Shader] Cannot have both resources and groups");if(!e&&n&&!l)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&n&&l)for(const t in l)for(const e in l[t]){const i=l[t][e];u[i]={group:t,binding:e,name:i}}else if(e&&n&&!l){const t=e.structsAndGroups.groups;l={},t.forEach((t=>{l[t.group]=l[t.group]||{},l[t.group][t.binding]=t.name,u[t.name]=t}))}else if(r){n={},l={},e&&e.structsAndGroups.groups.forEach((t=>{l[t.group]=l[t.group]||{},l[t.group][t.binding]=t.name,u[t.name]=t}));let t=0;for(const e in r)u[e]||(n[99]||(n[99]=new s.T,this._ownedBindGroups.push(n[99])),u[e]={group:99,binding:t,name:e},l[99]=l[99]||{},l[99][t]=e,t++);for(const t in r){const e=t;let i=r[t];i.source||i._resourceType||(i=new h.k(i));const o=u[e];o&&(n[o.group]||(n[o.group]=new s.T,this._ownedBindGroups.push(n[o.group])),n[o.group].setResource(i,o.binding))}}this.groups=n,this._uniformBindMap=l,this.resources=this._buildResourceAccessor(n,u)}addResource(t,e,i){var n,r;(n=this._uniformBindMap)[e]||(n[e]={}),(r=this._uniformBindMap[e])[i]||(r[i]=t),this.groups[e]||(this.groups[e]=new s.T,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){const i={};for(const n in e){const r=e[n];Object.defineProperty(i,r.name,{get:()=>t[r.group].getResource(r.binding),set(e){t[r.group].setResource(e,r.binding)}})}return i}destroy(t=!1){this.emit("destroy",this),t&&(this.gpuProgram?.destroy(),this.glProgram?.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach((t=>{t.destroy()})),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(t){const{gpu:e,gl:i,...n}=t;let s,a;return e&&(s=o.B.from(e)),i&&(a=r.M.from(i)),new l({gpuProgram:s,glProgram:a,...n})}}},5811:(t,e,i)=>{"use strict";i.d(e,{k:()=>l});var n=i(133),r=i(7952);const s=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>"],o=s.reduce(((t,e)=>(t[e]=!0,t)),{});function a(t,e){switch(t){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*e);case"vec3<f32>":return new Float32Array(3*e);case"vec4<f32>":return new Float32Array(4*e);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const h=class t{constructor(e,i){this._touched=0,this.uid=(0,n.L)("uniform"),this._resourceType="uniformGroup",this._resourceId=(0,n.L)("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,i={...t.defaultOptions,...i},this.uniformStructures=e;const h={};for(const t in e){const i=e[t];if(i.name=t,i.size=i.size??1,!o[i.type])throw new Error(`Uniform type ${i.type} is not supported. Supported uniform types are: ${s.join(", ")}`);i.value??(i.value=a(i.type,i.size)),h[t]=i.value}this.uniforms=h,this._dirtyId=1,this.ubo=i.ubo,this.isStatic=i.isStatic,this._signature=(0,r.X)(Object.keys(h).map((t=>`${t}-${e[t].type}`)).join("-"),"uniform-group")}update(){this._dirtyId++}};h.defaultOptions={ubo:!1,isStatic:!1};let l=h},7547:(t,e,i)=>{"use strict";i.d(e,{U:()=>s});const n={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8},r=class t{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}set cullMode(t){"none"!==t?(this.culling=!0,this.clockwiseFrontFace="front"===t):this.culling=!1}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend="none"!==t,this._blendMode=t,this._blendModeId=n[t]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const e=new t;return e.depthTest=!1,e.blend=!0,e}};r.default2d=r.for2d();let s=r},1957:(t,e,i)=>{"use strict";i.d(e,{K:()=>r,Q:()=>n});const n={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var r=(t=>(t[t.DISABLED=0]="DISABLED",t[t.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",t[t.MASK_ACTIVE=2]="MASK_ACTIVE",t[t.RENDERING_MASK_REMOVE=3]="RENDERING_MASK_REMOVE",t[t.NONE=4]="NONE",t))(r||{})},8639:(t,e,i)=>{"use strict";i.d(e,{i:()=>r});var n=i(1957);function r(t,e){return"no-premultiply-alpha"===e.alphaMode&&n.Q[t]||t}},7608:(t,e,i)=>{"use strict";i.d(e,{N:()=>s});var n=i(1761),r=i(9939);const s=new class{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const i=n.e.get().createCanvas();i.width=t,i.height=e;const r=i.getContext("2d");return{canvas:i,context:r}}getOptimalCanvasAndContext(t,e,i=1){t=Math.ceil(t*i-1e-6),e=Math.ceil(e*i-1e-6);const n=((t=(0,r.U5)(t))<<17)+((e=(0,r.U5)(e))<<1);this._canvasPool[n]||(this._canvasPool[n]=[]);let s=this._canvasPool[n].pop();return s||(s=this._createCanvasAndContext(t,e)),s}returnCanvasAndContext(t){const e=t.canvas,{width:i,height:n}=e,r=(i<<17)+(n<<1);this._canvasPool[r].push(t)}clear(){this._canvasPool={}}}},2437:(t,e,i)=>{"use strict";i.d(e,{W:()=>a});var n=i(9939),r=i(6932),s=i(4492);let o=0;const a=new class{constructor(t){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1}createTexture(t,e,i){const n=new r.v({...this.textureOptions,width:t,height:e,resolution:1,antialias:i,autoGarbageCollect:!0});return new s.g({source:n,label:"texturePool_"+o++})}getOptimalTexture(t,e,i=1,r){let s=Math.ceil(t*i-1e-6),o=Math.ceil(e*i-1e-6);s=(0,n.U5)(s),o=(0,n.U5)(o);const a=(s<<17)+(o<<1)+(r?1:0);this._texturePool[a]||(this._texturePool[a]=[]);let h=this._texturePool[a].pop();return h||(h=this.createTexture(s,o,r)),h.source._resolution=i,h.source.width=s/i,h.source.height=o/i,h.source.pixelWidth=s,h.source.pixelHeight=o,h.frame.x=0,h.frame.y=0,h.frame.width=t,h.frame.height=e,h.updateUvs(),this._poolKeyHash[h.uid]=a,h}getSameSizeTexture(t,e=!1){const i=t.source;return this.getOptimalTexture(t.width,t.height,i._resolution,e)}returnTexture(t){const e=this._poolKeyHash[t.uid];this._texturePool[e].push(t)}clear(t){if(t=!1!==t)for(const t in this._texturePool){const e=this._texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0)}this._texturePool={}}}},7952:(t,e,i)=>{"use strict";i.d(e,{X:()=>s});const n=Object.create(null),r=Object.create(null);function s(t,e){let i=r[t];return void 0===i&&(void 0===n[e]&&(n[e]=1),r[t]=i=n[e]++),i}},5099:(t,e,i)=>{"use strict";i.d(e,{W:()=>n});var n=(t=>(t[t.WEBGL=1]="WEBGL",t[t.WEBGPU=2]="WEBGPU",t[t.BOTH=3]="BOTH",t))(n||{})},2760:(t,e,i)=>{"use strict";function n(t,e,i){const n=(t>>24&255)/255;e[i++]=(255&t)/255*n,e[i++]=(t>>8&255)/255*n,e[i++]=(t>>16&255)/255*n,e[i++]=n}i.d(e,{V:()=>n})},8928:(t,e,i)=>{"use strict";var n=i(8507),r=i(3428),s=i(7547),o=i(8218),a=i(2760),h=i(4389);class l{constructor(t,e){this.state=s.U.for2d(),this._graphicsBatchesHash=Object.create(null),this.renderer=t,this._adaptor=e,this._adaptor.init()}validateRenderable(t){const e=t.context,i=!!this._graphicsBatchesHash[t.uid],n=this.renderer.graphicsContext.updateGpuContext(e);return!(!n.isBatchable&&i===n.isBatchable)}addRenderable(t,e){const i=this.renderer.graphicsContext.updateGpuContext(t.context);t._didGraphicsUpdate&&(t._didGraphicsUpdate=!1,this._rebuild(t)),i.isBatchable?this._addToBatcher(t):(this.renderer.renderPipes.batch.break(e),e.add(t))}updateRenderable(t){const e=this._graphicsBatchesHash[t.uid];if(e)for(let t=0;t<e.length;t++){const i=e[t];i.batcher.updateElement(i)}}destroyRenderable(t){this._graphicsBatchesHash[t.uid]&&this._removeBatchForRenderable(t.uid)}execute(t){if(!t.isRenderable)return;const e=this.renderer,i=t.context;if(!e.graphicsContext.getGpuContext(i).batches.length)return;const n=i.customShader||this._adaptor.shader;this.state.blendMode=t.groupBlendMode;const r=n.resources.localUniforms.uniforms;r.uTransformMatrix=t.groupTransform,r.uRound=e._roundPixels|t._roundPixels,(0,a.V)(t.groupColorAlpha,r.uColor,0),this._adaptor.execute(this,t)}_rebuild(t){const e=!!this._graphicsBatchesHash[t.uid],i=this.renderer.graphicsContext.updateGpuContext(t.context);e&&this._removeBatchForRenderable(t.uid),i.isBatchable&&this._initBatchesForRenderable(t),t.batched=i.isBatchable}_addToBatcher(t){const e=this.renderer.renderPipes.batch,i=this._getBatchesForRenderable(t);for(let t=0;t<i.length;t++){const n=i[t];e.addToBatch(n)}}_getBatchesForRenderable(t){return this._graphicsBatchesHash[t.uid]||this._initBatchesForRenderable(t)}_initBatchesForRenderable(t){const e=t.context,i=this.renderer.graphicsContext.getGpuContext(e),n=this.renderer._roundPixels|t._roundPixels,r=i.batches.map((e=>{const i=o.Z.get(h.G);return e.copyTo(i),i.renderable=t,i.roundPixels=n,i}));return void 0===this._graphicsBatchesHash[t.uid]&&t.on("destroyed",(()=>{this.destroyRenderable(t)})),this._graphicsBatchesHash[t.uid]=r,r}_removeBatchForRenderable(t){this._graphicsBatchesHash[t].forEach((t=>{o.Z.return(t)})),this._graphicsBatchesHash[t]=null}destroy(){this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null;for(const t in this._graphicsBatchesHash)this._removeBatchForRenderable(t);this._graphicsBatchesHash=null}}l.extension={type:[n.Ag.WebGLPipes,n.Ag.WebGPUPipes,n.Ag.CanvasPipes],name:"graphics"},n.XO.add(l),n.XO.add(r.GH)},4389:(t,e,i)=>{"use strict";i.d(e,{G:()=>n});class n{constructor(){this.batcher=null,this.batch=null,this.applyTransform=!0,this.roundPixels=0}get blendMode(){return this.applyTransform?this.renderable.groupBlendMode:"normal"}packIndex(t,e,i){const n=this.geometryData.indices;for(let r=0;r<this.indexSize;r++)t[e++]=n[r+this.indexOffset]+i-this.vertexOffset}packAttributes(t,e,i,n){const r=this.geometryData,s=this.renderable,o=r.vertices,a=r.uvs,h=2*this.vertexOffset,l=2*(this.vertexOffset+this.vertexSize),u=this.color,c=u>>16|65280&u|(255&u)<<16;if(this.applyTransform){const r=(d=c,p=s.groupColor,(16777215!==d&&p?16777215!==p&&d?((d>>16&255)*(p>>16&255)/255<<16)+((d>>8&255)*(p>>8&255)/255<<8)+(255&d)*(255&p)/255:d:p)+(this.alpha*s.groupAlpha*255<<24)),u=s.groupTransform,f=n<<16|65535&this.roundPixels,g=u.a,m=u.b,x=u.c,_=u.d,y=u.tx,v=u.ty;for(let n=h;n<l;n+=2){const s=o[n],h=o[n+1];t[i]=g*s+x*h+y,t[i+1]=m*s+_*h+v,t[i+2]=a[n],t[i+3]=a[n+1],e[i+4]=r,e[i+5]=f,i+=6}}else{const r=c+(255*this.alpha<<24);for(let s=h;s<l;s+=2)t[i]=o[s],t[i+1]=o[s+1],t[i+2]=a[s],t[i+3]=a[s+1],e[i+4]=r,e[i+5]=n<<16,i+=6}var d,p}get vertSize(){return this.vertexSize}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.vertexOffset=this.vertexOffset,t.vertexSize=this.vertexSize,t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData}reset(){this.applyTransform=!0}}},4835:(t,e,i)=>{"use strict";i.d(e,{T:()=>Q});var n=i(4486),r=i(2577),s=i(9313),o=i(5101),a=i(4492),h=i(133),l=i(4670),u=i(9636),c=i(268),d=i(8133),p=i(9252);class f{constructor(t=0,e=0,i=0){this.type="circle",this.x=t,this.y=e,this.radius=i}clone(){return new f(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let n=this.x-t,r=this.y-e;return n*=n,r*=r,n+r<=i}strokeContains(t,e,i){if(0===this.radius)return!1;const n=this.x-t,r=this.y-e,s=this.radius,o=i/2,a=Math.sqrt(n*n+r*r);return a<s+o&&a>s-o}getBounds(t){return(t=t||new p.M).x=this.x-this.radius,t.y=this.y-this.radius,t.width=2*this.radius,t.height=2*this.radius,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class g{constructor(t=0,e=0,i=0,n=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=i,this.halfHeight=n}clone(){return new g(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let i=(t-this.x)/this.halfWidth,n=(e-this.y)/this.halfHeight;return i*=i,n*=n,i+n<=1}strokeContains(t,e,i){const{halfWidth:n,halfHeight:r}=this;if(n<=0||r<=0)return!1;const s=i/2,o=n-s,a=r-s,h=n+s,l=r+s,u=t-this.x,c=e-this.y;return u*u/(o*o)+c*c/(a*a)>1&&u*u/(h*h)+c*c/(l*l)<=1}getBounds(t){return(t=t||new p.M).x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=2*this.halfWidth,t.height=2*this.halfHeight,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function m(t,e,i,n,r,s){const o=r-i,a=s-n,h=o*o+a*a;let l,u,c=-1;0!==h&&(c=((t-i)*o+(e-n)*a)/h),c<0?(l=i,u=n):c>1?(l=r,u=s):(l=i+c*o,u=n+c*a);const d=t-l,p=e-u;return d*d+p*p}class x{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let i=0,n=e.length;i<n;i++)t.push(e[i].x,e[i].y);e=t}this.points=e,this.closePath=!0}clone(){const t=this.points.slice(),e=new x(t);return e.closePath=this.closePath,e}contains(t,e){let i=!1;const n=this.points.length/2;for(let r=0,s=n-1;r<n;s=r++){const n=this.points[2*r],o=this.points[2*r+1],a=this.points[2*s],h=this.points[2*s+1];o>e!=h>e&&t<(e-o)/(h-o)*(a-n)+n&&(i=!i)}return i}strokeContains(t,e,i){const n=i/2,r=n*n,{points:s}=this,o=s.length-(this.closePath?0:2);for(let i=0;i<o;i+=2)if(m(t,e,s[i],s[i+1],s[(i+2)%s.length],s[(i+3)%s.length])<=r)return!0;return!1}getBounds(t){t=t||new p.M;const e=this.points;let i=1/0,n=-1/0,r=1/0,s=-1/0;for(let t=0,o=e.length;t<o;t+=2){const o=e[t],a=e[t+1];i=o<i?o:i,n=o>n?o:n,r=a<r?a:r,s=a>s?a:s}return t.x=i,t.width=n-i,t.y=r,t.height=s-r,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return this.points[this.points.length-2]}get y(){return this.points[this.points.length-1]}}const _=(t,e,i,n,r,s)=>{const o=t-i,a=e-n,h=Math.sqrt(o*o+a*a);return h>=r-s&&h<=r+s};class y{constructor(t=0,e=0,i=0,n=0,r=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=i,this.height=n,this.radius=r}getBounds(t){return(t=t||new p.M).x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new y(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let n=t-(this.x+i),r=e-(this.y+i);const s=i*i;if(n*n+r*r<=s)return!0;if(n=t-(this.x+this.width-i),n*n+r*r<=s)return!0;if(r=e-(this.y+this.height-i),n*n+r*r<=s)return!0;if(n=t-(this.x+i),n*n+r*r<=s)return!0}return!1}strokeContains(t,e,i){const{x:n,y:r,width:s,height:o,radius:a}=this,h=i/2,l=n+a,u=r+a,c=n+s,d=r+o;return(t>=n-h&&t<=n+h||t>=c-h&&t<=c+h)&&e>=u&&e<=u+(o-2*a)||(e>=r-h&&e<=r+h||e>=d-h&&e<=d+h)&&t>=l&&t<=l+(s-2*a)||t<l&&e<u&&_(t,e,l,u,a,h)||t>c-a&&e<u&&_(t,e,c-a,u,a,h)||t>c-a&&e>d-a&&_(t,e,c-a,d-a,a,h)||t<l&&e>d-a&&_(t,e,l,d-a,a,h)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}var v=i(3428);const b=8,T=1.1920929e-7,w=1,S=.01,P=0,M=0;function E(t,e,i,n,r,s,o,a,h,l){const u=Math.min(.99,Math.max(0,l??v.GH.defaultOptions.bezierSmoothness));let c=(w-u)/1;return c*=c,function(t,e,i,n,r,s,o,a,h,l){C(t,e,i,n,r,s,o,a,h,l,0),h.push(o,a)}(e,i,n,r,s,o,a,h,t,c),t}function C(t,e,i,n,r,s,o,a,h,l,u){if(u>b)return;const c=Math.PI,d=(t+i)/2,p=(e+n)/2,f=(i+r)/2,g=(n+s)/2,m=(r+o)/2,x=(s+a)/2,_=(d+f)/2,y=(p+g)/2,v=(f+m)/2,w=(g+x)/2,E=(_+v)/2,k=(y+w)/2;if(u>0){let u=o-t,d=a-e;const p=Math.abs((i-o)*d-(n-a)*u),f=Math.abs((r-o)*d-(s-a)*u);let g,m;if(p>T&&f>T){if((p+f)*(p+f)<=l*(u*u+d*d)){if(P<S)return void h.push(E,k);const l=Math.atan2(s-n,r-i);if(g=Math.abs(l-Math.atan2(n-e,i-t)),m=Math.abs(Math.atan2(a-s,o-r)-l),g>=c&&(g=2*c-g),m>=c&&(m=2*c-m),g+m<P)return void h.push(E,k);if(0!==M){if(g>M)return void h.push(i,n);if(m>M)return void h.push(r,s)}}}else if(p>T){if(p*p<=l*(u*u+d*d)){if(P<S)return void h.push(E,k);if(g=Math.abs(Math.atan2(s-n,r-i)-Math.atan2(n-e,i-t)),g>=c&&(g=2*c-g),g<P)return h.push(i,n),void h.push(r,s);if(0!==M&&g>M)return void h.push(i,n)}}else if(f>T){if(f*f<=l*(u*u+d*d)){if(P<S)return void h.push(E,k);if(g=Math.abs(Math.atan2(a-s,o-r)-Math.atan2(s-n,r-i)),g>=c&&(g=2*c-g),g<P)return h.push(i,n),void h.push(r,s);if(0!==M&&g>M)return void h.push(r,s)}}else if(u=E-(t+o)/2,d=k-(e+a)/2,u*u+d*d<=l)return void h.push(E,k)}C(t,e,d,p,_,y,E,k,h,l,u+1),C(E,k,v,w,m,x,o,a,h,l,u+1)}const k=8,A=1.1920929e-7,B=.01,R=0;function I(t,e,i,n,r,s,o,a){let h=(1-Math.min(.99,Math.max(0,a??v.GH.defaultOptions.bezierSmoothness)))/1;return h*=h,function(t,e,i,n,r,s,o,a){F(o,t,e,i,n,r,s,a,0),o.push(r,s)}(e,i,n,r,s,o,t,h),t}function F(t,e,i,n,r,s,o,a,h){if(h>k)return;const l=Math.PI,u=(e+n)/2,c=(i+r)/2,d=(n+s)/2,p=(r+o)/2,f=(u+d)/2,g=(c+p)/2;let m=s-e,x=o-i;const _=Math.abs((n-s)*x-(r-o)*m);if(_>A){if(_*_<=a*(m*m+x*x)){if(R<B)return void t.push(f,g);let a=Math.abs(Math.atan2(o-r,s-n)-Math.atan2(r-i,n-e));if(a>=l&&(a=2*l-a),a<R)return void t.push(f,g)}}else if(m=f-(e+s)/2,x=g-(i+o)/2,m*m+x*x<=a)return void t.push(f,g);F(t,e,i,u,c,f,g,a,h+1),F(t,f,g,d,p,s,o,a,h+1)}function z(t,e,i,n,r,s,o,a){let h=Math.abs(r-s);(!o&&r>s||o&&s>r)&&(h=2*Math.PI-h),a=a||Math.max(6,Math.floor(6*Math.pow(n,1/3)*(h/Math.PI)));let l=h/(a=Math.max(a,3)),u=r;l*=o?-1:1;for(let r=0;r<a+1;r++){const r=e+Math.cos(u)*n,s=i+Math.sin(u)*n;t.push(r,s),u+=l}}const U=2*Math.PI,D={centerX:0,centerY:0,ang1:0,ang2:0},O=({x:t,y:e},i,n,r,s,o,a,h)=>{const l=r*(t*=i)-s*(e*=n),u=s*t+r*e;return h.x=l+o,h.y=u+a,h};function L(t,e){const i=-1.5707963267948966===e?-.551915024494:4/3*Math.tan(e/4),n=1.5707963267948966===e?.551915024494:i,r=Math.cos(t),s=Math.sin(t),o=Math.cos(t+e),a=Math.sin(t+e);return[{x:r-s*n,y:s+r*n},{x:o+a*n,y:a-o*n},{x:o,y:a}]}const W=(t,e,i,n)=>{let r=t*i+e*n;return r>1&&(r=1),r<-1&&(r=-1),(t*n-e*i<0?-1:1)*Math.acos(r)};const G=new p.M;class H{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new u.c,this._graphicsPath2D=t}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const i=this._currentPoly.points,n=i[i.length-2],r=i[i.length-1];return n===t&&r===e||i.push(t,e),this}arc(t,e,i,n,r,s){return this._ensurePoly(!1),z(this._currentPoly.points,t,e,i,n,r,s),this}arcTo(t,e,i,n,r){return this._ensurePoly(),function(t,e,i,n,r,s){const o=t[t.length-2],a=t[t.length-1]-i,h=o-e,l=r-i,u=n-e,c=Math.abs(a*u-h*l);if(c<1e-8||0===s)return void(t[t.length-2]===e&&t[t.length-1]===i||t.push(e,i));const d=a*a+h*h,p=l*l+u*u,f=a*l+h*u,g=s*Math.sqrt(d)/c,m=s*Math.sqrt(p)/c,x=g*f/d,_=m*f/p,y=g*u+m*h,v=g*l+m*a,b=h*(m+x),T=a*(m+x),w=u*(g+_),S=l*(g+_);z(t,y+e,v+i,s,Math.atan2(T-v,b-y),Math.atan2(S-v,w-y),h*l>u*a)}(this._currentPoly.points,t,e,i,n,r),this}arcToSvg(t,e,i,n,r,s,o){return function(t,e,i,n,r,s,o,a=0,h=0,l=0){if(0===s||0===o)return;const u=Math.sin(a*U/360),c=Math.cos(a*U/360),d=c*(e-n)/2+u*(i-r)/2,p=-u*(e-n)/2+c*(i-r)/2;if(0===d&&0===p)return;s=Math.abs(s),o=Math.abs(o);const f=Math.pow(d,2)/Math.pow(s,2)+Math.pow(p,2)/Math.pow(o,2);f>1&&(s*=Math.sqrt(f),o*=Math.sqrt(f)),((t,e,i,n,r,s,o,a,h,l,u,c,d)=>{const p=Math.pow(r,2),f=Math.pow(s,2),g=Math.pow(u,2),m=Math.pow(c,2);let x=p*f-p*m-f*g;x<0&&(x=0),x/=p*m+f*g,x=Math.sqrt(x)*(o===a?-1:1);const _=x*r/s*c,y=x*-s/r*u,v=l*_-h*y+(t+i)/2,b=h*_+l*y+(e+n)/2,T=(u-_)/r,w=(c-y)/s,S=(-u-_)/r,P=(-c-y)/s,M=W(1,0,T,w);let E=W(T,w,S,P);0===a&&E>0&&(E-=U),1===a&&E<0&&(E+=U),d.centerX=v,d.centerY=b,d.ang1=M,d.ang2=E})(e,i,n,r,s,o,h,l,u,c,d,p,D);let{ang1:g,ang2:m}=D;const{centerX:x,centerY:_}=D;let y=Math.abs(m)/(U/4);Math.abs(1-y)<1e-7&&(y=1);const v=Math.max(Math.ceil(y),1);m/=v;let b=t[t.length-2],T=t[t.length-1];const w={x:0,y:0};for(let e=0;e<v;e++){const e=L(g,m),{x:i,y:n}=O(e[0],s,o,c,u,x,_,w),{x:r,y:a}=O(e[1],s,o,c,u,x,_,w),{x:h,y:l}=O(e[2],s,o,c,u,x,_,w);E(t,b,T,i,n,r,a,h,l),b=h,T=l,g+=m}}(this._currentPoly.points,this._currentPoly.lastX,this._currentPoly.lastY,s,o,t,e,i,n,r),this}bezierCurveTo(t,e,i,n,r,s,o){this._ensurePoly();const a=this._currentPoly;return E(this._currentPoly.points,a.lastX,a.lastY,t,e,i,n,r,s,o),this}quadraticCurveTo(t,e,i,n,r){this._ensurePoly();const s=this._currentPoly;return I(this._currentPoly.points,s.lastX,s.lastY,t,e,i,n,r),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0)).transform(e);for(let e=0;e<t.instructions.length;e++){const i=t.instructions[e];this[i.action](...i.data)}return this}finish(t=!1){this.endPoly(t)}rect(t,e,i,n,r){return this.drawShape(new p.M(t,e,i,n),r),this}circle(t,e,i,n){return this.drawShape(new f(t,e,i),n),this}poly(t,e,i){const n=new x(t);return n.closePath=e,this.drawShape(n,i),this}regularPoly(t,e,i,n,r=0,s){n=Math.max(0|n,3);const o=-1*Math.PI/2+r,a=2*Math.PI/n,h=[];for(let r=0;r<n;r++){const n=r*a+o;h.push(t+i*Math.cos(n),e+i*Math.sin(n))}return this.poly(h,!0,s),this}roundPoly(t,e,i,n,r,s=0,o){if(n=Math.max(0|n,3),r<=0)return this.regularPoly(t,e,i,n,s);const a=i*Math.sin(Math.PI/n)-.001;r=Math.min(r,a);const h=-1*Math.PI/2+s,l=2*Math.PI/n,u=(n-2)*Math.PI/n/2;for(let s=0;s<n;s++){const n=s*l+h,a=t+i*Math.cos(n),c=e+i*Math.sin(n),d=n+Math.PI+u,p=n-Math.PI-u,f=a+r*Math.cos(d),g=c+r*Math.sin(d),m=a+r*Math.cos(p),x=c+r*Math.sin(p);0===s?this.moveTo(f,g):this.lineTo(f,g),this.quadraticCurveTo(a,c,m,x,o)}return this.closePath()}roundShape(t,e,i=!1,n){return t.length<3?this:(i?function(t,e,i,n){const r=(t,e)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),s=(t,e,i)=>({x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i}),o=e.length;for(let a=0;a<o;a++){const h=e[(a+1)%o],l=h.radius??i;if(l<=0){0===a?t.moveTo(h.x,h.y):t.lineTo(h.x,h.y);continue}const u=e[a],c=e[(a+2)%o],d=r(u,h);let p;p=d<1e-4?h:s(h,u,Math.min(d/2,l)/d);const f=r(c,h);let g;g=f<1e-4?h:s(h,c,Math.min(f/2,l)/f),0===a?t.moveTo(p.x,p.y):t.lineTo(p.x,p.y),t.quadraticCurveTo(h.x,h.y,g.x,g.y,n)}}(this,t,e,n):function(t,e,i){const n=(t,e)=>{const i=e.x-t.x,n=e.y-t.y,r=Math.sqrt(i*i+n*n);return{len:r,nx:i/r,ny:n/r}},r=(e,i)=>{0===e?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y)};let s=e[e.length-1];for(let o=0;o<e.length;o++){const a=e[o%e.length],h=a.radius??i;if(h<=0){r(o,a),s=a;continue}const l=e[(o+1)%e.length],u=n(a,s),c=n(a,l);if(u.len<1e-4||c.len<1e-4){r(o,a),s=a;continue}let d=Math.asin(u.nx*c.ny-u.ny*c.nx),p=1,f=!1;u.nx*c.nx-u.ny*-c.ny<0?d<0?d=Math.PI+d:(d=Math.PI-d,p=-1,f=!0):d>0&&(p=-1,f=!0);const g=d/2;let m,x=Math.abs(Math.cos(g)*h/Math.sin(g));x>Math.min(u.len/2,c.len/2)?(x=Math.min(u.len/2,c.len/2),m=Math.abs(x*Math.sin(g)/Math.cos(g))):m=h;const _=a.x+c.nx*x+-c.ny*m*p,y=a.y+c.ny*x+c.nx*m*p,v=Math.atan2(u.ny,u.nx)+Math.PI/2*p,b=Math.atan2(c.ny,c.nx)-Math.PI/2*p;0===o&&t.moveTo(_+Math.cos(v)*m,y+Math.sin(v)*m),t.arc(_,y,m,v,b,f),s=a}}(this,t,e),this.closePath())}filletRect(t,e,i,n,r){if(0===r)return this.rect(t,e,i,n);const s=Math.min(i,n)/2,o=Math.min(s,Math.max(-s,r)),a=t+i,h=e+n,l=o<0?-o:0,u=Math.abs(o);return this.moveTo(t,e+u).arcTo(t+l,e+l,t+u,e,u).lineTo(a-u,e).arcTo(a-l,e+l,a,e+u,u).lineTo(a,h-u).arcTo(a-l,h-l,t+i-u,h,u).lineTo(t+u,h).arcTo(t+l,h-l,t,h-u,u).closePath()}chamferRect(t,e,i,n,r,s){if(r<=0)return this.rect(t,e,i,n);const o=Math.min(r,Math.min(i,n)/2),a=t+i,h=e+n,l=[t+o,e,a-o,e,a,e+o,a,h-o,a-o,h,t+o,h,t,h-o,t,e+o];for(let t=l.length-1;t>=2;t-=2)l[t]===l[t-2]&&l[t-1]===l[t-3]&&l.splice(t-1,2);return this.poly(l,!0,s)}ellipse(t,e,i,n,r){return this.drawShape(new g(t,e,i,n),r),this}roundRect(t,e,i,n,r,s){return this.drawShape(new y(t,e,i,n,r),s),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let i=this._currentPoly;return i&&this.endPoly(),i=new x,i.points.push(t,e),this._currentPoly=i,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new x,t)){const t=this.shapePrimitives[this.shapePrimitives.length-1];if(t){let e=t.shape.x,i=t.shape.y;if(t.transform&&!t.transform.isIdentity()){const n=t.transform,r=e;e=n.a*e+n.c*i+n.tx,i=n.b*r+n.d*i+n.ty}this._currentPoly.points.push(e,i)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const i=t.instructions[e];this[i.action](...i.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let i=0;i<e.length;i++){const n=e[i],r=n.shape.getBounds(G);n.transform?t.addRect(r,n.transform):t.addRect(r)}return t}}class ${constructor(t){this.instructions=[],this.uid=(0,h.L)("graphicsPath"),this._dirty=!0,"string"==typeof t?function(t,e){const i=d(t),n=[];let r=null,s=0,o=0;for(let t=0;t<i.length;t++){const a=i[t],h=a[0],l=a;switch(h){case"M":s=l[1],o=l[2],e.moveTo(s,o);break;case"m":s+=l[1],o+=l[2],e.moveTo(s,o);break;case"H":s=l[1],e.lineTo(s,o);break;case"h":s+=l[1],e.lineTo(s,o);break;case"V":o=l[1],e.lineTo(s,o);break;case"v":o+=l[1],e.lineTo(s,o);break;case"L":s=l[1],o=l[2],e.lineTo(s,o);break;case"l":s+=l[1],o+=l[2],e.lineTo(s,o);break;case"C":s=l[5],o=l[6],e.bezierCurveTo(l[1],l[2],l[3],l[4],s,o);break;case"c":e.bezierCurveTo(s+l[1],o+l[2],s+l[3],o+l[4],s+l[5],o+l[6]),s+=l[5],o+=l[6];break;case"S":s=l[3],o=l[4],e.bezierCurveToShort(l[1],l[2],s,o);break;case"s":e.bezierCurveToShort(s+l[1],o+l[2],s+l[3],o+l[4]),s+=l[3],o+=l[4];break;case"Q":s=l[3],o=l[4],e.quadraticCurveTo(l[1],l[2],s,o);break;case"q":e.quadraticCurveTo(s+l[1],o+l[2],s+l[3],o+l[4]),s+=l[3],o+=l[4];break;case"T":s=l[1],o=l[2],e.quadraticCurveToShort(s,o);break;case"t":s+=l[1],o+=l[2],e.quadraticCurveToShort(s,o);break;case"A":s=l[6],o=l[7],e.arcToSvg(l[1],l[2],l[3],l[4],l[5],s,o);break;case"a":s+=l[6],o+=l[7],e.arcToSvg(l[1],l[2],l[3],l[4],l[5],s,o);break;case"Z":case"z":e.closePath(),n.length>0&&(r=n.pop(),r?(s=r.startX,o=r.startY):(s=0,o=0)),r=null;break;default:(0,c.R)(`Unknown SVG path command: ${h}`)}"Z"!==h&&"z"!==h&&null===r&&(r={startX:s,startY:o},n.push(r))}}(t,this):this.instructions=t?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new H(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,i,n,r){const s=this.instructions[this.instructions.length-1],a=this.getLastPoint(o.b.shared);let h=0,l=0;if(s&&"bezierCurveTo"===s.action){h=s.data[2],l=s.data[3];const t=a.x,e=a.y;h=t+(t-h),l=e+(e-l)}else h=a.x,l=a.y;return this.instructions.push({action:"bezierCurveTo",data:[h,l,t,e,i,n,r]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,i){const n=this.instructions[this.instructions.length-1],r=this.getLastPoint(o.b.shared);let s=0,a=0;if(n&&"quadraticCurveTo"===n.action){s=n.data[0],a=n.data[1];const t=r.x,e=r.y;s=t+(t-s),a=e+(e-a)}else s=r.x,a=r.y;return this.instructions.push({action:"quadraticCurveTo",data:[s,a,t,e,i]}),this._dirty=!0,this}rect(t,e,i,n,r){return this.instructions.push({action:"rect",data:[t,e,i,n,r]}),this._dirty=!0,this}circle(t,e,i,n){return this.instructions.push({action:"circle",data:[t,e,i,n]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,i,n,r,s,o){r=r||n/2;const a=-1*Math.PI/2+s,h=2*i,l=2*Math.PI/h,u=[];for(let i=0;i<h;i++){const s=i%2?r:n,o=i*l+a;u.push(t+s*Math.cos(o),e+s*Math.sin(o))}return this.poly(u,!0,o),this}clone(t=!1){const e=new $;if(t)for(let t=0;t<this.instructions.length;t++){const i=this.instructions[t];e.instructions.push({action:i.action,data:i.data.slice()})}else e.instructions=this.instructions.slice();return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,i=t.b,n=t.c,r=t.d,s=t.tx,o=t.ty;let a=0,h=0,l=0,u=0,d=0,p=0,f=0,g=0;for(let m=0;m<this.instructions.length;m++){const x=this.instructions[m],_=x.data;switch(x.action){case"moveTo":case"lineTo":a=_[0],h=_[1],_[0]=e*a+n*h+s,_[1]=i*a+r*h+o;break;case"bezierCurveTo":l=_[0],u=_[1],d=_[2],p=_[3],a=_[4],h=_[5],_[0]=e*l+n*u+s,_[1]=i*l+r*u+o,_[2]=e*d+n*p+s,_[3]=i*d+r*p+o,_[4]=e*a+n*h+s,_[5]=i*a+r*h+o;break;case"quadraticCurveTo":l=_[0],u=_[1],a=_[2],h=_[3],_[0]=e*l+n*u+s,_[1]=i*l+r*u+o,_[2]=e*a+n*h+s,_[3]=i*a+r*h+o;break;case"arcToSvg":a=_[5],h=_[6],f=_[0],g=_[1],_[0]=e*f+n*g,_[1]=i*f+r*g,_[5]=e*a+n*h+s,_[6]=i*a+r*h+o;break;case"circle":_[4]=V(_[3],t);break;case"rect":_[4]=V(_[4],t);break;case"ellipse":_[8]=V(_[8],t);break;case"roundRect":_[5]=V(_[5],t);break;case"addPath":_[0].transform(t);break;case"poly":_[2]=V(_[2],t);break;default:(0,c.R)("unknown transform action",x.action)}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,i=this.instructions[e];if(!i)return t.x=0,t.y=0,t;for(;"closePath"===i.action;){if(e--,e<0)return t.x=0,t.y=0,t;i=this.instructions[e]}switch(i.action){case"moveTo":case"lineTo":t.x=i.data[0],t.y=i.data[1];break;case"quadraticCurveTo":t.x=i.data[2],t.y=i.data[3];break;case"bezierCurveTo":t.x=i.data[4],t.y=i.data[5];break;case"arc":case"arcToSvg":t.x=i.data[5],t.y=i.data[6];break;case"addPath":i.data[0].getLastPoint(t)}return t}}function V(t,e){return t?t.prepend(e):e.clone()}function X(t,e){if("string"==typeof t){const e=document.createElement("div");e.innerHTML=t.trim(),t=e.querySelector("svg")}return N(t,{context:e,path:new $},null,null),e}function N(t,e,i,n){const s=t.children,{fillStyle:o,strokeStyle:a}=function(t){const e=t.getAttribute("style"),i={},n={};let s=!1,o=!1;if(e){const t=e.split(";");for(let e=0;e<t.length;e++){const a=t[e],[h,l]=a.split(":");switch(h){case"stroke":"none"!==l&&(i.color=r.Q.shared.setValue(l).toNumber(),o=!0);break;case"stroke-width":i.width=Number(l);break;case"fill":"none"!==l&&(s=!0,n.color=r.Q.shared.setValue(l).toNumber());break;case"fill-opacity":n.alpha=Number(l);break;case"stroke-opacity":i.alpha=Number(l);break;case"opacity":n.alpha=Number(l),i.alpha=Number(l)}}}else{const e=t.getAttribute("stroke");e&&"none"!==e&&(o=!0,i.color=r.Q.shared.setValue(e).toNumber(),i.width=Y(t,"stroke-width",1));const a=t.getAttribute("fill");a&&"none"!==a&&(s=!0,n.color=r.Q.shared.setValue(a).toNumber())}return{strokeStyle:o?i:null,fillStyle:s?n:null}}(t);let h,l,u,c,d,p,f,g,m,x,_,y,v,b,T,w,S;switch(o&&i?i={...i,...o}:o&&(i=o),a&&n?n={...n,...a}:a&&(n=a),e.context.fillStyle=i,e.context.strokeStyle=n,t.nodeName.toLowerCase()){case"path":b=t.getAttribute("d"),T=new $(b),e.context.path(T),i&&e.context.fill(),n&&e.context.stroke();break;case"circle":f=Y(t,"cx",0),g=Y(t,"cy",0),m=Y(t,"r",0),e.context.ellipse(f,g,m,m),i&&e.context.fill(),n&&e.context.stroke();break;case"rect":h=Y(t,"x",0),l=Y(t,"y",0),w=Y(t,"width",0),S=Y(t,"height",0),x=Y(t,"rx",0),_=Y(t,"ry",0),x||_?e.context.roundRect(h,l,w,S,x||_):e.context.rect(h,l,w,S),i&&e.context.fill(),n&&e.context.stroke();break;case"ellipse":f=Y(t,"cx",0),g=Y(t,"cy",0),x=Y(t,"rx",0),_=Y(t,"ry",0),e.context.beginPath(),e.context.ellipse(f,g,x,_),i&&e.context.fill(),n&&e.context.stroke();break;case"line":u=Y(t,"x1",0),c=Y(t,"y1",0),d=Y(t,"x2",0),p=Y(t,"y2",0),e.context.beginPath(),e.context.moveTo(u,c),e.context.lineTo(d,p),n&&e.context.stroke();break;case"polygon":v=t.getAttribute("points"),y=v.match(/\d+/g).map((t=>parseInt(t,10))),e.context.poly(y,!0),i&&e.context.fill(),n&&e.context.stroke();break;case"polyline":v=t.getAttribute("points"),y=v.match(/\d+/g).map((t=>parseInt(t,10))),e.context.poly(y,!1),n&&e.context.stroke();break;case"g":case"svg":break;default:console.info(`[SVG parser] <${t.nodeName}> elements unsupported`)}for(let t=0;t<s.length;t++)N(s[t],e,i,n)}function Y(t,e,i){const n=t.getAttribute(e);return n?Number(n):i}var j=i(990);const K=new o.b,q=new s.u,Z=class t extends n.A{constructor(){super(...arguments),this.uid=(0,h.L)("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new $,this._transform=new s.u,this._fillStyle={...t.defaultFillStyle},this._strokeStyle={...t.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new u.c,this._boundsDirty=!0}clone(){const e=new t;return e.batchMode=this.batchMode,e.instructions=this.instructions.slice(),e._activePath=this._activePath.clone(),e._transform=this._transform.clone(),e._fillStyle={...this._fillStyle},e._strokeStyle={...this._strokeStyle},e._stateStack=this._stateStack.slice(),e._bounds=this._bounds.clone(),e._boundsDirty=!0,e}get fillStyle(){return this._fillStyle}set fillStyle(e){this._fillStyle=(0,j.w)(e,t.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(e){this._strokeStyle=(0,j.T)(e,t.defaultStrokeStyle)}setFillStyle(e){return this._fillStyle=(0,j.w)(e,t.defaultFillStyle),this}setStrokeStyle(e){return this._strokeStyle=(0,j.w)(e,t.defaultStrokeStyle),this}texture(t,e,i,n,s,o){return this.instructions.push({action:"texture",data:{image:t,dx:i||0,dy:n||0,dw:s||t.frame.width,dh:o||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?r.Q.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new $,this}fill(e,i){let n;const r=this.instructions[this.instructions.length-1];return n=0===this._tick&&r&&"stroke"===r.action?r.data.path:this._activePath.clone(),n?(null!=e&&(void 0!==i&&"number"==typeof e&&((0,l.t)(l.l,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),e={color:e,alpha:i}),this._fillStyle=(0,j.w)(e,t.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:n}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(o.b.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(e){let i;const n=this.instructions[this.instructions.length-1];return i=0===this._tick&&n&&"fill"===n.action?n.data.path:this._activePath.clone(),i?(null!=e&&(this._strokeStyle=(0,j.T)(e,t.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:i}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],i=this._activePath.clone();if(e&&("stroke"===e.action||"fill"===e.action)){if(!e.data.hole){e.data.hole=i;break}e.data.hole.addPath(i)}}return this._initNextPathLocation(),this}arc(t,e,i,n,r,s){this._tick++;const o=this._transform;return this._activePath.arc(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,i,n,r,s),this}arcTo(t,e,i,n,r){this._tick++;const s=this._transform;return this._activePath.arcTo(s.a*t+s.c*e+s.tx,s.b*t+s.d*e+s.ty,s.a*i+s.c*n+s.tx,s.b*i+s.d*n+s.ty,r),this}arcToSvg(t,e,i,n,r,s,o){this._tick++;const a=this._transform;return this._activePath.arcToSvg(t,e,i,n,r,a.a*s+a.c*o+a.tx,a.b*s+a.d*o+a.ty),this}bezierCurveTo(t,e,i,n,r,s,o){this._tick++;const a=this._transform;return this._activePath.bezierCurveTo(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,a.a*i+a.c*n+a.tx,a.b*i+a.d*n+a.ty,a.a*r+a.c*s+a.tx,a.b*r+a.d*s+a.ty,o),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(t,e,i,n){return this._tick++,this._activePath.ellipse(t,e,i,n,this._transform.clone()),this}circle(t,e,i){return this._tick++,this._activePath.circle(t,e,i,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const i=this._transform;return this._activePath.lineTo(i.a*t+i.c*e+i.tx,i.b*t+i.d*e+i.ty),this}moveTo(t,e){this._tick++;const i=this._transform,n=this._activePath.instructions,r=i.a*t+i.c*e+i.tx,s=i.b*t+i.d*e+i.ty;return 1===n.length&&"moveTo"===n[0].action?(n[0].data[0]=r,n[0].data[1]=s,this):(this._activePath.moveTo(r,s),this)}quadraticCurveTo(t,e,i,n,r){this._tick++;const s=this._transform;return this._activePath.quadraticCurveTo(s.a*t+s.c*e+s.tx,s.b*t+s.d*e+s.ty,s.a*i+s.c*n+s.tx,s.b*i+s.d*n+s.ty,r),this}rect(t,e,i,n){return this._tick++,this._activePath.rect(t,e,i,n,this._transform.clone()),this}roundRect(t,e,i,n,r){return this._tick++,this._activePath.roundRect(t,e,i,n,r,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,i,n,r=0,s){return this._tick++,this._activePath.regularPoly(t,e,i,n,r,s),this}roundPoly(t,e,i,n,r,s){return this._tick++,this._activePath.roundPoly(t,e,i,n,r,s),this}roundShape(t,e,i,n){return this._tick++,this._activePath.roundShape(t,e,i,n),this}filletRect(t,e,i,n,r){return this._tick++,this._activePath.filletRect(t,e,i,n,r),this}chamferRect(t,e,i,n,r,s){return this._tick++,this._activePath.chamferRect(t,e,i,n,r,s),this}star(t,e,i,n,r=0,s=0){return this._tick++,this._activePath.star(t,e,i,n,r,s,this._transform.clone()),this}svg(t){return this._tick++,X(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,i,n,r,o){return t instanceof s.u?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,i,n,r,o),this)}transform(t,e,i,n,r,o){return t instanceof s.u?(this._transform.append(t),this):(q.set(t,e,i,n,r,o),this._transform.append(q),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const i=this.instructions[e],n=i.action;if("fill"===n){const e=i.data;t.addBounds(e.path.bounds)}else if("texture"===n){const e=i.data;t.addFrame(e.dx,e.dy,e.dx+e.dw,e.dy+e.dh,e.transform)}if("stroke"===n){const e=i.data,n=e.style.width/2,r=e.path.bounds;t.addFrame(r.minX-n,r.minY-n,r.maxX+n,r.maxY+n)}}return t}containsPoint(t){if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let i=!1;for(let n=0;n<e.length;n++){const r=e[n],s=r.data,o=s.path;if(!r.action||!o)continue;const a=s.style,h=o.shapePath.shapePrimitives;for(let e=0;e<h.length;e++){const n=h[e].shape;if(!a||!n)continue;const o=h[e].transform,l=o?o.applyInverse(t,K):t;i="fill"===r.action?n.contains(l.x,l.y):n.strokeContains(l.x,l.y,a.width);const u=s.hole;if(u){const t=u.shapePath?.shapePrimitives;if(t)for(let e=0;e<t.length;e++)t[e].shape.contains(l.x,l.y)&&(i=!1)}if(i)return!0}}return i}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),"boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(e),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(e)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};Z.defaultFillStyle={color:16777215,alpha:1,texture:a.g.WHITE,matrix:null,fill:null},Z.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:a.g.WHITE,matrix:null,fill:null};let Q=Z},3428:(t,e,i)=>{"use strict";i.d(e,{GH:()=>R});var n=i(8507),r=i(341),s=i(5130),o=i(1617),a=i(848),h=i(8218),l=i(9252);function u(t,e,i,n,r){const s=e.a,o=e.b,a=e.c,h=e.d,l=e.tx,u=e.ty;i=i||0,n=n||2,r=r||t.length/n-i;let c=i*n;for(let e=0;e<r;e++){const e=t[c],i=t[c+1];t[c]=s*e+a*i+l,t[c+1]=o*e+h*i+u,c+=n}}var c=i(4492),d=i(4389);const p={extension:{type:n.Ag.ShapeBuilder,name:"circle"},build(t,e){let i,n,r,s,o,a;if("circle"===t.type){const e=t;i=e.x,n=e.y,o=a=e.radius,r=s=0}else if("ellipse"===t.type){const e=t;i=e.x,n=e.y,o=e.halfWidth,a=e.halfHeight,r=s=0}else{const e=t,h=e.width/2,l=e.height/2;i=e.x+h,n=e.y+l,o=a=Math.max(0,Math.min(e.radius,Math.min(h,l))),r=h-o,s=l-a}if(!(o>=0&&a>=0&&r>=0&&s>=0))return e;const h=Math.ceil(2.3*Math.sqrt(o+a)),l=8*h+(r?4:0)+(s?4:0);if(0===l)return e;if(0===h)return e[0]=e[6]=i+r,e[1]=e[3]=n+s,e[2]=e[4]=i-r,e[5]=e[7]=n-s,e;let u=0,c=4*h+(r?2:0)+2,d=c,p=l,f=r+o,g=s,m=i+f,x=i-f,_=n+g;if(e[u++]=m,e[u++]=_,e[--c]=_,e[--c]=x,s){const t=n-g;e[d++]=x,e[d++]=t,e[--p]=t,e[--p]=m}for(let t=1;t<h;t++){const l=Math.PI/2*(t/h),f=r+Math.cos(l)*o,g=s+Math.sin(l)*a,m=i+f,x=i-f,_=n+g,y=n-g;e[u++]=m,e[u++]=_,e[--c]=_,e[--c]=x,e[d++]=x,e[d++]=y,e[--p]=y,e[--p]=m}f=r,g=s+a,m=i+f,x=i-f,_=n+g;const y=n-g;return e[u++]=m,e[u++]=_,e[--p]=y,e[--p]=m,r&&(e[u++]=x,e[u++]=_,e[--p]=y,e[--p]=x),e},triangulate(t,e,i,n,r,s){if(0===t.length)return;let o=0,a=0;for(let e=0;e<t.length;e+=2)o+=t[e],a+=t[e+1];o/=t.length/2,a/=t.length/2;let h=n;e[h*i]=o,e[h*i+1]=a;const l=h++;for(let n=0;n<t.length;n+=2)e[h*i]=t[n],e[h*i+1]=t[n+1],n>0&&(r[s++]=h,r[s++]=l,r[s++]=h-1),h++;r[s++]=l+1,r[s++]=l,r[s++]=h-1}},f={...p,extension:{...p.extension,name:"ellipse"}},g={...p,extension:{...p.extension,name:"roundedRectangle"}};var m=i(5101);function x(t,e,i,n,r,s,o,a){let h,l;o?(h=n,l=-i):(h=-n,l=i);const u=t-i*r+h,c=e-n*r+l,d=t+i*s+h,p=e+n*s+l;return a.push(u,c),a.push(d,p),2}function _(t,e,i,n,r,s,o,a){const h=i-t,l=n-e;let u=Math.atan2(h,l),c=Math.atan2(r-t,s-e);a&&u<c?u+=2*Math.PI:!a&&u>c&&(c+=2*Math.PI);let d=u;const p=c-u,f=Math.abs(p),g=Math.sqrt(h*h+l*l),m=1+(15*f*Math.sqrt(g)/Math.PI|0),x=p/m;if(d+=x,a){o.push(t,e),o.push(i,n);for(let i=1,n=d;i<m;i++,n+=x)o.push(t,e),o.push(t+Math.sin(n)*g,e+Math.cos(n)*g);o.push(t,e),o.push(r,s)}else{o.push(i,n),o.push(t,e);for(let i=1,n=d;i<m;i++,n+=x)o.push(t+Math.sin(n)*g,e+Math.cos(n)*g),o.push(t,e);o.push(r,s),o.push(t,e)}return 2*m}var y=i(6570);function v(t,e,i,n,r,s,o){const a=y(t,e,2);if(!a)return;for(let t=0;t<a.length;t+=3)s[o++]=a[t]+r,s[o++]=a[t+1]+r,s[o++]=a[t+2]+r;let h=r*n;for(let e=0;e<t.length;e+=2)i[h]=t[e],i[h+1]=t[e+1],h+=n}const b=[],T={extension:{type:n.Ag.ShapeBuilder,name:"polygon"},build(t,e){for(let i=0;i<t.points.length;i++)e[i]=t.points[i];return e},triangulate(t,e,i,n,r,s){v(t,b,e,i,n,r,s)}},w={extension:{type:n.Ag.ShapeBuilder,name:"rectangle"},build(t,e){const i=t,n=i.x,r=i.y,s=i.width,o=i.height;return s>=0&&o>=0?(e[0]=n,e[1]=r,e[2]=n+s,e[3]=r,e[4]=n+s,e[5]=r+o,e[6]=n,e[7]=r+o,e):e},triangulate(t,e,i,n,r,s){let o=0;e[(n*=i)+o]=t[0],e[n+o+1]=t[1],o+=i,e[n+o]=t[2],e[n+o+1]=t[3],o+=i,e[n+o]=t[6],e[n+o+1]=t[7],o+=i,e[n+o]=t[4],e[n+o+1]=t[5],o+=i;const a=n/i;r[s++]=a,r[s++]=a+1,r[s++]=a+2,r[s++]=a+1,r[s++]=a+3,r[s++]=a+2}},S={extension:{type:n.Ag.ShapeBuilder,name:"triangle"},build:(t,e)=>(e[0]=t.x,e[1]=t.y,e[2]=t.x2,e[3]=t.y2,e[4]=t.x3,e[5]=t.y3,e),triangulate(t,e,i,n,r,s){let o=0;e[(n*=i)+o]=t[0],e[n+o+1]=t[1],o+=i,e[n+o]=t[2],e[n+o+1]=t[3],o+=i,e[n+o]=t[4],e[n+o+1]=t[5];const a=n/i;r[s++]=a,r[s++]=a+1,r[s++]=a+2}},P={};n.XO.handleByMap(n.Ag.ShapeBuilder,P),n.XO.add(w,T,S,p,f,g);const M=new l.M;function E(t,e,i){const{vertices:n,uvs:r,indices:s}=i,o=s.length,a=n.length/2,l=[],c=P.rectangle,p=M,f=t.image;p.x=t.dx,p.y=t.dy,p.width=t.dw,p.height=t.dh;const g=t.transform;c.build(p,l),g&&u(l,g),c.triangulate(l,n,2,a,s,o);const m=f.uvs;r.push(m.x0,m.y0,m.x1,m.y1,m.x3,m.y3,m.x2,m.y2);const x=h.Z.get(d.G);x.indexOffset=o,x.indexSize=s.length-o,x.vertexOffset=a,x.vertexSize=n.length/2-a,x.color=t.style,x.alpha=t.alpha,x.texture=f,x.geometryData=i,e.push(x)}function C(t,e,i,n,r,s){const{vertices:o,uvs:a,indices:l}=s,p=t.shapePrimitives.length-1;t.shapePrimitives.forEach((({shape:t,transform:f},g)=>{const y=l.length,b=o.length/2,T=[],w=P[t.type];if(w.build(t,T),f&&u(T,f),n){const i=t.closePath??!0;!function(t,e,i,n,r,s,o,a){const h=1e-4;if(0===t.length)return;const l=e;let u=l.alignment;if(.5!==e.alignment){let e=function(t){const e=t.length;if(e<6)return 1;let i=0;for(let n=0,r=t[e-2],s=t[e-1];n<e;n+=2){const e=t[n],o=t[n+1];i+=(e-r)*(o+s),r=e,s=o}return i<0?-1:1}(t);u=(u-.5)*e+.5}const c=new m.b(t[0],t[1]),d=new m.b(t[t.length-2],t[t.length-1]),p=n,f=Math.abs(c.x-d.x)<h&&Math.abs(c.y-d.y)<h;if(p){t=t.slice(),f&&(t.pop(),t.pop(),d.set(t[t.length-2],t[t.length-1]));const e=.5*(c.x+d.x),i=.5*(d.y+c.y);t.unshift(e,i),t.push(e,i)}const g=r,y=t.length/2;let v=t.length;const b=g.length/2,T=l.width/2,w=T*T,S=l.miterLimit*l.miterLimit;let P=t[0],M=t[1],E=t[2],C=t[3],k=0,A=0,B=-(M-C),R=P-E,I=0,F=0,z=Math.sqrt(B*B+R*R);B/=z,R/=z,B*=T,R*=T;const U=2*(1-u),D=2*u;p||("round"===l.cap?v+=_(P-B*(U-D)*.5,M-R*(U-D)*.5,P-B*U,M-R*U,P+B*D,M+R*D,g,!0)+2:"square"===l.cap&&(v+=x(P,M,B,R,U,D,!0,g))),g.push(P-B*U,M-R*U),g.push(P+B*D,M+R*D);for(let e=1;e<y-1;++e){P=t[2*(e-1)],M=t[2*(e-1)+1],E=t[2*e],C=t[2*e+1],k=t[2*(e+1)],A=t[2*(e+1)+1],B=-(M-C),R=P-E,z=Math.sqrt(B*B+R*R),B/=z,R/=z,B*=T,R*=T,I=-(C-A),F=E-k,z=Math.sqrt(I*I+F*F),I/=z,F/=z,I*=T,F*=T;const i=E-P,n=M-C,r=E-k,s=A-C,o=i*r+n*s,a=n*r-s*i,h=a<0;if(Math.abs(a)<.001*Math.abs(o)){g.push(E-B*U,C-R*U),g.push(E+B*D,C+R*D),o>=0&&("round"===l.join?v+=_(E,C,E-B*U,C-R*U,E-I*U,C-F*U,g,!1)+4:v+=2,g.push(E-I*D,C-F*D),g.push(E+I*U,C+F*U));continue}const u=(-B+P)*(-R+C)-(-B+E)*(-R+M),c=(-I+k)*(-F+C)-(-I+E)*(-F+A),d=(i*c-r*u)/a,p=(s*u-n*c)/a,f=(d-E)*(d-E)+(p-C)*(p-C),m=E+(d-E)*U,x=C+(p-C)*U,y=E-(d-E)*D,b=C-(p-C)*D,O=h?U:D;f<=Math.min(i*i+n*n,r*r+s*s)+O*O*w?"bevel"===l.join||f/w>S?(h?(g.push(m,x),g.push(E+B*D,C+R*D),g.push(m,x),g.push(E+I*D,C+F*D)):(g.push(E-B*U,C-R*U),g.push(y,b),g.push(E-I*U,C-F*U),g.push(y,b)),v+=2):"round"===l.join?h?(g.push(m,x),g.push(E+B*D,C+R*D),v+=_(E,C,E+B*D,C+R*D,E+I*D,C+F*D,g,!0)+4,g.push(m,x),g.push(E+I*D,C+F*D)):(g.push(E-B*U,C-R*U),g.push(y,b),v+=_(E,C,E-B*U,C-R*U,E-I*U,C-F*U,g,!1)+4,g.push(E-I*U,C-F*U),g.push(y,b)):(g.push(m,x),g.push(y,b)):(g.push(E-B*U,C-R*U),g.push(E+B*D,C+R*D),"round"===l.join?v+=h?_(E,C,E+B*D,C+R*D,E+I*D,C+F*D,g,!0)+2:_(E,C,E-B*U,C-R*U,E-I*U,C-F*U,g,!1)+2:"miter"===l.join&&f/w<=S&&(h?(g.push(y,b),g.push(y,b)):(g.push(m,x),g.push(m,x)),v+=2),g.push(E-I*U,C-F*U),g.push(E+I*D,C+F*D),v+=2)}P=t[2*(y-2)],M=t[2*(y-2)+1],E=t[2*(y-1)],C=t[2*(y-1)+1],B=-(M-C),R=P-E,z=Math.sqrt(B*B+R*R),B/=z,R/=z,B*=T,R*=T,g.push(E-B*U,C-R*U),g.push(E+B*D,C+R*D),p||("round"===l.cap?v+=_(E-B*(U-D)*.5,C-R*(U-D)*.5,E-B*U,C-R*U,E+B*D,C+R*D,g,!1)+2:"square"===l.cap&&(v+=x(E,C,B,R,U,D,!1,g)));for(let t=b;t<v+b-2;++t)P=g[2*t],M=g[2*t+1],E=g[2*(t+1)],C=g[2*(t+1)+1],k=g[2*(t+2)],A=g[2*(t+2)+1],Math.abs(P*(C-A)+E*(A-M)+k*(M-C))<1e-8||a.push(t,t+1,t+2)}(T,e,0,i,o,0,0,l)}else if(i&&p===g){0!==p&&console.warn("[Pixi Graphics] only the last shape have be cut out");const t=[],e=T.slice(),n=function(t){if(!t)return[];const e=t.shapePrimitives,i=[];for(let t=0;t<e.length;t++){const n=e[t].shape,r=[];P[n.type].build(n,r),i.push(r)}return i}(i.shapePath);n.forEach((i=>{t.push(e.length/2),e.push(...i)})),v(e,t,o,2,b,l,y)}else w.triangulate(T,o,2,b,l,y);const S=a.length/2,M=e.texture;if(M!==c.g.WHITE){const t=e.matrix;t&&(f&&t.append(f.clone().invert()),function(t,e,i,n,r,s,o,a=null){let h=0;i*=e,r*=s;const l=a.a,u=a.b,c=a.c,d=a.d,p=a.tx,f=a.ty;for(;h<o;){const o=t[i],a=t[i+1];n[r]=l*o+c*a+p,n[r+1]=u*o+d*a+f,r+=s,i+=e,h++}}(o,2,b,a,S,2,o.length/2-b,t))}else!function(t,e,i,n){let r=0;for(e*=2;r<n;)t[e]=0,t[e+1]=0,e+=2,r++}(a,S,0,o.length/2-b);const E=h.Z.get(d.G);E.indexOffset=y,E.indexSize=l.length-y,E.vertexOffset=b,E.vertexSize=o.length/2-b,E.color=e.color,E.alpha=e.alpha,E.texture=M,E.geometryData=s,r.push(E)}))}class k{constructor(){this.batcher=new s.i,this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class A{constructor(){this.geometry=new o.J,this.instructions=new a.L}init(){this.instructions.reset()}}const B=class t{constructor(){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null)}init(e){t.defaultOptions.bezierSmoothness=e?.bezierSmoothness??t.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),function(t,e){const{geometryData:i,batches:n}=e;n.length=0,i.indices.length=0,i.vertices.length=0,i.uvs.length=0;for(let e=0;e<t.instructions.length;e++){const r=t.instructions[e];if("texture"===r.action)E(r.data,n,i);else if("fill"===r.action||"stroke"===r.action){const t="stroke"===r.action,e=r.data.path.shapePath,s=r.data.style,o=r.data.hole;t&&o&&C(o.shapePath,s,null,!0,n,i),C(e,s,o,t,n,i)}}}(t,e);const i=t.batchMode;t.customShader||"no-batch"===i?e.isBatchable=!1:"auto"===i&&(e.isBatchable=e.geometryData.vertices.length<400),t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=h.Z.get(A),{batches:i,geometryData:n,batcher:s}=this._gpuContextHash[t.uid],o=n.vertices.length,a=n.indices.length;for(let t=0;t<i.length;t++)i[t].applyTransform=!1;s.ensureAttributeBuffer(o),s.ensureIndexBuffer(a),s.begin();for(let t=0;t<i.length;t++){const e=i[t];s.add(e)}s.finish(e.instructions);const l=e.geometry;l.indexBuffer.setDataWithSize(s.indexBuffer,s.indexSize,!0),l.buffers[0].setDataWithSize(s.attributeBuffer.float32View,s.attributeSize,!0);const u=s.batches;for(let t=0;t<u.length;t++){const e=u[t];e.bindGroup=(0,r.w)(e.textures.textures,e.textures.count)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new k;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(h.Z.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach((t=>{h.Z.return(t)}))}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context)}};B.extension={type:[n.Ag.WebGLSystem,n.Ag.WebGPUSystem,n.Ag.CanvasSystem],name:"graphicsContext"},B.defaultOptions={bezierSmoothness:.5};let R=B},7276:(t,e,i)=>{"use strict";i.d(e,{_:()=>u});var n=i(2577),r=i(1761),s=i(9313),o=i(8293),a=i(4492),h=i(133);const l=class t{constructor(t,e,i,n){this.uid=(0,h.L)("fillGradient"),this.type="linear",this.gradientStops=[],this._styleKey=null,this.x0=t,this.y0=e,this.x1=i,this.y1=n}addColorStop(t,e){return this.gradientStops.push({offset:t,color:n.Q.shared.setValue(e).toHexa()}),this._styleKey=null,this}buildLinearGradient(){const e=t.defaultTextureSize,{gradientStops:i}=this,n=r.e.get().createCanvas();n.width=e,n.height=e;const h=n.getContext("2d"),l=h.createLinearGradient(0,0,t.defaultTextureSize,1);for(let t=0;t<i.length;t++){const e=i[t];l.addColorStop(e.offset,e.color)}h.fillStyle=l,h.fillRect(0,0,e,e),this.texture=new a.g({source:new o.b({resource:n,addressModeU:"clamp-to-edge",addressModeV:"repeat"})});const{x0:u,y0:c,x1:d,y1:p}=this,f=new s.u,g=d-u,m=p-c,x=Math.sqrt(g*g+m*m),_=Math.atan2(m,g);f.translate(-u,-c),f.scale(1/e,1/e),f.rotate(-_),f.scale(256/x,1),this.transform=f,this._styleKey=null}get styleKey(){if(this._styleKey)return this._styleKey;const t=this.gradientStops.map((t=>`${t.offset}-${t.color}`)).join("-"),e=this.texture.uid,i=this.transform.toArray().join("-");return`fill-gradient-${this.uid}-${t}-${e}-${i}-${this.x0}-${this.y0}-${this.x1}-${this.y1}`}};l.defaultTextureSize=256;let u=l},2806:(t,e,i)=>{"use strict";i.d(e,{m:()=>o});var n=i(9313),r=i(133);const s={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class o{constructor(t,e){this.uid=(0,r.L)("fillPattern"),this.transform=new n.u,this._styleKey=null,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=s[e].addressModeU,t.source.style.addressModeV=s[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._styleKey=null}get styleKey(){return this._styleKey||(this._styleKey=`fill-pattern-${this.uid}-${this.texture.uid}-${this.transform.toArray().join("-")}`),this._styleKey}}},990:(t,e,i)=>{"use strict";i.d(e,{T:()=>p,w:()=>d});var n=i(2577),r=i(9313),s=i(4492),o=i(7276),a=i(2806);function h(t){return t instanceof a.m}function l(t){return t instanceof o._}function u(t,e,i){return t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,{...i,...t}}function c(t,e,i){return e.buildLinearGradient(),t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,{...i,...t}}function d(t,e){if(null==t)return null;const i={},o=t;return function(t){return n.Q.isColorLike(t)}(t)?function(t,e,i){const r=n.Q.shared.setValue(e??0);return t.color=r.toNumber(),t.alpha=1===r.alpha?i.alpha:r.alpha,t.texture=s.g.WHITE,{...i,...t}}(i,t,e):h(t)?u(i,t,e):l(t)?c(i,t,e):o.fill&&h(o.fill)?u(o,o.fill,e):o.fill&&l(o.fill)?c(o,o.fill,e):function(t,e){const i={...e,...t};if(i.texture){if(i.texture!==s.g.WHITE){const t=i.matrix?.invert()||new r.u;t.translate(i.texture.frame.x,i.texture.frame.y),t.scale(1/i.texture.source.width,1/i.texture.source.height),i.matrix=t}const t=i.texture.source.style;"clamp-to-edge"===t.addressMode&&(t.addressMode="repeat",t.update())}const o=n.Q.shared.setValue(i.color);return i.alpha*=o.alpha,i.color=o.toNumber(),i.matrix=i.matrix?i.matrix.clone():null,i}(o,e)}function p(t,e){const{width:i,alignment:n,miterLimit:r,cap:s,join:o,...a}=e,h=d(t,a);return h?{width:i,alignment:n,miterLimit:r,cap:s,join:o,...h}:null}},5285:(t,e,i)=>{"use strict";var n=i(8507),r=i(9313),s=i(3513),o=i(5811),a=i(8639),h=i(8218),l=i(2760),u=i(8734);class c{constructor(t,e){this.localUniforms=new o.k({uTransformMatrix:{value:new r.u,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new s.T({0:this.localUniforms}),this._meshDataHash=Object.create(null),this._gpuBatchableMeshHash=Object.create(null),this.renderer=t,this._adaptor=e,this._adaptor.init()}validateRenderable(t){const e=this._getMeshData(t),i=e.batched,n=t.batched;if(e.batched=n,i!==n)return!0;if(n){const i=t._geometry;if(i.indices.length!==e.indexSize||i.positions.length!==e.vertexSize)return e.indexSize=i.indices.length,e.vertexSize=i.positions.length,!0;const n=this._getBatchableMesh(t),r=t.texture;if(n.texture._source!==r._source&&n.texture._source!==r._source)return!n.batcher.checkAndUpdateTexture(n,r)}return!1}addRenderable(t,e){const i=this.renderer.renderPipes.batch,{batched:n}=this._getMeshData(t);if(n){const e=this._getBatchableMesh(t);e.texture=t._texture,e.geometry=t._geometry,i.addToBatch(e)}else i.break(e),e.add(t)}updateRenderable(t){if(t.batched){const e=this._gpuBatchableMeshHash[t.uid];e.texture=t._texture,e.geometry=t._geometry,e.batcher.updateElement(e)}}destroyRenderable(t){this._meshDataHash[t.uid]=null;const e=this._gpuBatchableMeshHash[t.uid];e&&(h.Z.return(e),this._gpuBatchableMeshHash[t.uid]=null)}execute(t){if(!t.isRenderable)return;t.state.blendMode=(0,a.i)(t.groupBlendMode,t.texture._source);const e=this.localUniforms;e.uniforms.uTransformMatrix=t.groupTransform,e.uniforms.uRound=this.renderer._roundPixels|t._roundPixels,e.update(),(0,l.V)(t.groupColorAlpha,e.uniforms.uColor,0),this._adaptor.execute(this,t)}_getMeshData(t){return this._meshDataHash[t.uid]||this._initMeshData(t)}_initMeshData(t){return this._meshDataHash[t.uid]={batched:t.batched,indexSize:t._geometry.indices?.length,vertexSize:t._geometry.positions?.length},t.on("destroyed",(()=>{this.destroyRenderable(t)})),this._meshDataHash[t.uid]}_getBatchableMesh(t){return this._gpuBatchableMeshHash[t.uid]||this._initBatchableMesh(t)}_initBatchableMesh(t){const e=h.Z.get(u.U);return e.mesh=t,e.texture=t._texture,e.roundPixels=this.renderer._roundPixels|t._roundPixels,this._gpuBatchableMeshHash[t.uid]=e,e.mesh=t,e}destroy(){for(const t in this._gpuBatchableMeshHash)this._gpuBatchableMeshHash[t]&&h.Z.return(this._gpuBatchableMeshHash[t]);this._gpuBatchableMeshHash=null,this._meshDataHash=null,this.localUniforms=null,this.localUniformsBindGroup=null,this._adaptor.destroy(),this._adaptor=null,this.renderer=null}}c.extension={type:[n.Ag.WebGLPipes,n.Ag.WebGPUPipes,n.Ag.CanvasPipes],name:"mesh"},n.XO.add(c)},8734:(t,e,i)=>{"use strict";i.d(e,{U:()=>n});class n{constructor(){this.batcher=null,this.batch=null,this.roundPixels=0,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}get blendMode(){return this.mesh.groupBlendMode}reset(){this.mesh=null,this.texture=null,this.batcher=null,this.batch=null}packIndex(t,e,i){const n=this.geometry.indices;for(let r=0;r<n.length;r++)t[e++]=n[r]+i}packAttributes(t,e,i,n){const r=this.mesh,s=this.geometry,o=r.groupTransform,a=n<<16|65535&this.roundPixels,h=o.a,l=o.b,u=o.c,c=o.d,d=o.tx,p=o.ty,f=s.positions,g=s.getBuffer("aUV"),m=g.data;let x=m;const _=this.texture.textureMatrix;_.isSimple||(x=this._transformedUvs,this._textureMatrixUpdateId===_._updateID&&this._uvUpdateId===g._updateID||((!x||x.length<m.length)&&(x=this._transformedUvs=new Float32Array(m.length)),this._textureMatrixUpdateId=_._updateID,this._uvUpdateId=g._updateID,_.multiplyUvs(m,x)));const y=r.groupColorAlpha;for(let n=0;n<f.length;n+=2){const r=f[n],s=f[n+1];t[i]=h*r+u*s+d,t[i+1]=l*r+c*s+p,t[i+2]=x[n],t[i+3]=x[n+1],e[i+4]=y,e[i+5]=a,i+=6}}get vertexSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}},5060:(t,e,i)=>{"use strict";i.d(e,{u:()=>h});var n=i(949),r=i(1132),s=i(6011),o=i(4670);const a=class t extends s.V{constructor(...e){let i=e[0]??{};i instanceof Float32Array&&((0,o.t)(o.l,"use new MeshGeometry({ positions, uvs, indices }) instead"),i={positions:i,uvs:e[1],indices:e[2]}),i={...t.defaultOptions,...i};const s=i.positions||new Float32Array([0,0,1,0,1,1,0,1]),a=i.uvs||new Float32Array([0,0,1,0,1,1,0,1]),h=i.indices||new Uint32Array([0,1,2,0,2,3]),l=i.shrinkBuffersToFit;super({attributes:{aPosition:{buffer:new n.h({data:s,label:"attribute-mesh-positions",shrinkToFit:l,usage:r.S.VERTEX|r.S.COPY_DST}),format:"float32x2",stride:8,offset:0},aUV:{buffer:new n.h({data:a,label:"attribute-mesh-uvs",shrinkToFit:l,usage:r.S.VERTEX|r.S.COPY_DST}),format:"float32x2",stride:8,offset:0}},indexBuffer:new n.h({data:h,label:"index-mesh-buffer",shrinkToFit:l,usage:r.S.INDEX|r.S.COPY_DST}),topology:i.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(t){this.attributes.aPosition.buffer.data=t}get uvs(){return this.attributes.aUV.buffer.data}set uvs(t){this.attributes.aUV.buffer.data=t}get indices(){return this.indexBuffer.data}set indices(t){this.indexBuffer.data=t}};a.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};let h=a},7252:(t,e,i)=>{"use strict";var n=i(8507),r=i(8218),s=i(8734),o=i(4670),a=i(5060);const h=class t extends a.u{constructor(...t){super({});let e=t[0]??{};"number"==typeof e&&((0,o.t)(o.l,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),e={width:e,height:t[1],verticesX:t[2],verticesY:t[3]}),this.build(e)}build(e){e={...t.defaultOptions,...e},this.verticesX=this.verticesX??e.verticesX,this.verticesY=this.verticesY??e.verticesY,this.width=this.width??e.width,this.height=this.height??e.height;const i=this.verticesX*this.verticesY,n=[],r=[],s=[],o=this.verticesX-1,a=this.verticesY-1,h=this.width/o,l=this.height/a;for(let t=0;t<i;t++){const e=t%this.verticesX,i=t/this.verticesX|0;n.push(e*h,i*l),r.push(e/o,i/a)}const u=o*a;for(let t=0;t<u;t++){const e=t%o,i=t/o|0,n=i*this.verticesX+e,r=i*this.verticesX+e+1,a=(i+1)*this.verticesX+e,h=(i+1)*this.verticesX+e+1;s.push(n,r,a,r,h,a)}this.buffers[0].data=new Float32Array(n),this.buffers[1].data=new Float32Array(r),this.indexBuffer.data=new Uint32Array(s),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};h.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};let l=h;const u=class t extends l{constructor(e={}){super({width:(e={...t.defaultOptions,...e}).width,height:e.height,verticesX:4,verticesY:4}),this.update(e)}update(t){this.width=t.width??this.width,this.height=t.height??this.height,this._originalWidth=t.originalWidth??this._originalWidth,this._originalHeight=t.originalHeight??this._originalHeight,this._leftWidth=t.leftWidth??this._leftWidth,this._rightWidth=t.rightWidth??this._rightWidth,this._topHeight=t.topHeight??this._topHeight,this._bottomHeight=t.bottomHeight??this._bottomHeight,this.updateUvs(),this.updatePositions()}updatePositions(){const t=this.positions,e=this._leftWidth+this._rightWidth,i=this.width>e?1:this.width/e,n=this._topHeight+this._bottomHeight,r=this.height>n?1:this.height/n,s=Math.min(i,r);t[9]=t[11]=t[13]=t[15]=this._topHeight*s,t[17]=t[19]=t[21]=t[23]=this.height-this._bottomHeight*s,t[25]=t[27]=t[29]=t[31]=this.height,t[2]=t[10]=t[18]=t[26]=this._leftWidth*s,t[4]=t[12]=t[20]=t[28]=this.width-this._rightWidth*s,t[6]=t[14]=t[22]=t[30]=this.width,this.getBuffer("aPosition").update()}updateUvs(){const t=this.uvs;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1;const e=1/this._originalWidth,i=1/this._originalHeight;t[2]=t[10]=t[18]=t[26]=e*this._leftWidth,t[9]=t[11]=t[13]=t[15]=i*this._topHeight,t[4]=t[12]=t[20]=t[28]=1-e*this._rightWidth,t[17]=t[19]=t[21]=t[23]=1-i*this._bottomHeight,this.getBuffer("aUV").update()}};u.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};let c=u;class d{constructor(t){this._gpuSpriteHash=Object.create(null),this._renderer=t}addRenderable(t,e){const i=this._getGpuSprite(t);t._didSpriteUpdate&&this._updateBatchableSprite(t,i),this._renderer.renderPipes.batch.addToBatch(i)}updateRenderable(t){const e=this._gpuSpriteHash[t.uid];t._didSpriteUpdate&&this._updateBatchableSprite(t,e),e.batcher.updateElement(e)}validateRenderable(t){const e=t._texture,i=this._getGpuSprite(t);return i.texture._source!==e._source&&!i.batcher.checkAndUpdateTexture(i,e)}destroyRenderable(t){const e=this._gpuSpriteHash[t.uid];r.Z.return(e),this._gpuSpriteHash[t.uid]=null}_updateBatchableSprite(t,e){t._didSpriteUpdate=!1,e.geometry.update(t),e.texture=t._texture}_getGpuSprite(t){return this._gpuSpriteHash[t.uid]||this._initGPUSprite(t)}_initGPUSprite(t){const e=new s.U;return e.geometry=new c,e.mesh=t,e.texture=t._texture,e.roundPixels=this._renderer._roundPixels|t._roundPixels,this._gpuSpriteHash[t.uid]=e,t.on("destroyed",(()=>{this.destroyRenderable(t)})),e}destroy(){for(const t in this._gpuSpriteHash)this._gpuSpriteHash[t].geometry.destroy();this._gpuSpriteHash=null,this._renderer=null}}d.extension={type:[n.Ag.WebGLPipes,n.Ag.WebGPUPipes,n.Ag.CanvasPipes],name:"nineSliceSprite"},n.XO.add(d)},8723:(t,e,i)=>{"use strict";var n=i(8507),r=i(8639),s=i(7547),o=i(5099),a=i(2760),h=i(8734),l=i(5060),u=i(9313),c=i(5611),d=i(2067),p=i(6665),f=i(8475),g=i(5811),m=i(4492);const x={name:"tiling-bit",vertex:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n            uv = (tilingUniforms.uTextureTransform * vec3(uv, 1.0)).xy;\n\n            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;\n        "},fragment:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n\n            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);\n            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;\n            var unclamped = coord;\n            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);\n\n            var bias = 0.;\n\n            if(unclamped.x == coord.x && unclamped.y == coord.y)\n            {\n                bias = -32.;\n            } \n\n            outColor = textureSampleBias(uTexture, uSampler, coord, bias);\n        "}},_={name:"tiling-bit",vertex:{header:"\n            uniform mat3 uTextureTransform;\n            uniform vec4 uSizeAnchor;\n        \n        ",main:"\n            uv = (uTextureTransform * vec3(aUV, 1.0)).xy;\n\n            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;\n        "},fragment:{header:"\n            uniform sampler2D uTexture;\n            uniform mat3 uMapCoord;\n            uniform vec4 uClampFrame;\n            uniform vec2 uClampOffset;\n        ",main:"\n\n        vec2 coord = vUV + ceil(uClampOffset - vUV);\n        coord = (uMapCoord * vec3(coord, 1.0)).xy;\n        vec2 unclamped = coord;\n        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n        \n        outColor = texture(uTexture, coord, unclamped == coord ? 0.0 : -32.0);// lod-bias very negative to force lod 0\n    \n        "}};let y,v;class b extends f.M{constructor(){y??(y=(0,c.v)({name:"tiling-sprite-shader",bits:[d.Ls,x,p.b]})),v??(v=(0,c.I)({name:"tiling-sprite-shader",bits:[d.mA,_,p.m]}));const t=new g.k({uMapCoord:{value:new u.u,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new u.u,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,100,.5,.5]),type:"vec4<f32>"}});super({glProgram:v,gpuProgram:y,resources:{localUniforms:new g.k({uTransformMatrix:{value:new u.u,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),tilingUniforms:t,uTexture:m.g.EMPTY.source,uSampler:m.g.EMPTY.source.style}})}updateUniforms(t,e,i,n,r,s){const o=this.resources.tilingUniforms,a=s.width,h=s.height,l=s.textureMatrix,u=o.uniforms.uTextureTransform;u.set(i.a*a/t,i.b*a/e,i.c*h/t,i.d*h/e,i.tx/t,i.ty/e),u.invert(),o.uniforms.uMapCoord=l.mapCoord,o.uniforms.uClampFrame=l.uClampFrame,o.uniforms.uClampOffset=l.uClampOffset,o.uniforms.uTextureTransform=u,o.uniforms.uSizeAnchor[0]=t,o.uniforms.uSizeAnchor[1]=e,o.uniforms.uSizeAnchor[2]=n,o.uniforms.uSizeAnchor[3]=r,s&&(this.resources.uTexture=s.source,this.resources.uSampler=s.source.style)}}class T extends l.u{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}}const w=new T;class S{constructor(t){this._state=s.U.default2d,this._tilingSpriteDataHash=Object.create(null),this._renderer=t}validateRenderable(t){const e=this._getTilingSpriteData(t),i=e.canBatch;this._updateCanBatch(t);const n=e.canBatch;if(n&&n===i){const{batchableMesh:i}=e;if(i&&i.texture._source!==t.texture._source)return!i.batcher.checkAndUpdateTexture(i,t.texture)}return i!==n}addRenderable(t,e){const i=this._renderer.renderPipes.batch;this._updateCanBatch(t);const n=this._getTilingSpriteData(t),{geometry:r,canBatch:s}=n;if(s){n.batchableMesh||(n.batchableMesh=new h.U);const e=n.batchableMesh;t._didTilingSpriteUpdate&&(t._didTilingSpriteUpdate=!1,this._updateBatchableMesh(t),e.geometry=r,e.mesh=t,e.texture=t._texture),e.roundPixels=this._renderer._roundPixels|t._roundPixels,i.addToBatch(e)}else i.break(e),n.shader||(n.shader=new b),this.updateRenderable(t),e.add(t)}execute(t){const{shader:e}=this._tilingSpriteDataHash[t.uid];e.groups[0]=this._renderer.globalUniforms.bindGroup;const i=e.resources.localUniforms.uniforms;i.uTransformMatrix=t.groupTransform,i.uRound=this._renderer._roundPixels|t._roundPixels,(0,a.V)(t.groupColorAlpha,i.uColor,0),this._state.blendMode=(0,r.i)(t.groupBlendMode,t.texture._source),this._renderer.encoder.draw({geometry:w,shader:e,state:this._state})}updateRenderable(t){const e=this._getTilingSpriteData(t),{canBatch:i}=e;if(i){const{batchableMesh:i}=e;t._didTilingSpriteUpdate&&this._updateBatchableMesh(t),i.batcher.updateElement(i)}else if(t._didTilingSpriteUpdate){const{shader:i}=e;i.updateUniforms(t.width,t.height,t._tileTransform.matrix,t.anchor.x,t.anchor.y,t.texture)}t._didTilingSpriteUpdate=!1}destroyRenderable(t){const e=this._getTilingSpriteData(t);e.batchableMesh=null,e.shader?.destroy(),this._tilingSpriteDataHash[t.uid]=null}_getTilingSpriteData(t){return this._tilingSpriteDataHash[t.uid]||this._initTilingSpriteData(t)}_initTilingSpriteData(t){const e=new l.u({indices:w.indices,positions:w.positions.slice(),uvs:w.uvs.slice()});return this._tilingSpriteDataHash[t.uid]={canBatch:!0,renderable:t,geometry:e},t.on("destroyed",(()=>{this.destroyRenderable(t)})),this._tilingSpriteDataHash[t.uid]}_updateBatchableMesh(t){const e=this._getTilingSpriteData(t),{geometry:i}=e,n=t.texture.source.style;"repeat"!==n.addressMode&&(n.addressMode="repeat",n.update()),function(t,e){const i=t.texture,n=i.frame.width,r=i.frame.height;let s=0,o=0;t._applyAnchorToTexture&&(s=t.anchor.x,o=t.anchor.y),e[0]=e[6]=-s,e[2]=e[4]=1-s,e[1]=e[3]=-o,e[5]=e[7]=1-o;const a=u.u.shared;a.copyFrom(t._tileTransform.matrix),a.tx/=t.width,a.ty/=t.height,a.invert(),a.scale(t.width/n,t.height/r),function(t,e,i,n){let r=0;const s=t.length/2,o=n.a,a=n.b,h=n.c,l=n.d,u=n.tx,c=n.ty;for(i*=2;r<s;){const e=t[i],n=t[i+1];t[i]=o*e+h*n+u,t[i+1]=a*e+l*n+c,i+=2,r++}}(e,0,0,a)}(t,i.uvs),function(t,e){const i=t.anchor.x,n=t.anchor.y;e[0]=-i*t.width,e[1]=-n*t.height,e[2]=(1-i)*t.width,e[3]=-n*t.height,e[4]=(1-i)*t.width,e[5]=(1-n)*t.height,e[6]=-i*t.width,e[7]=(1-n)*t.height}(t,i.positions)}destroy(){for(const t in this._tilingSpriteDataHash)this.destroyRenderable(this._tilingSpriteDataHash[t].renderable);this._tilingSpriteDataHash=null,this._renderer=null}_updateCanBatch(t){const e=this._getTilingSpriteData(t),i=t.texture;let n=!0;return this._renderer.type===o.W.WEBGL&&(n=this._renderer.context.supports.nonPowOf2wrapping),e.canBatch=i.textureMatrix.isSimple&&(n||i.source.isPowerOfTwo),e.canBatch}}S.extension={type:[n.Ag.WebGLPipes,n.Ag.WebGPUPipes,n.Ag.CanvasPipes],name:"tilingSprite"},n.XO.add(S)},8422:(t,e,i)=>{"use strict";i.d(e,{K:()=>n});class n{constructor(){this.vertexSize=4,this.indexSize=6,this.location=0,this.batcher=null,this.batch=null,this.roundPixels=0}get blendMode(){return this.renderable.groupBlendMode}packAttributes(t,e,i,n){const r=this.renderable,s=this.texture,o=r.groupTransform,a=o.a,h=o.b,l=o.c,u=o.d,c=o.tx,d=o.ty,p=this.bounds,f=p.maxX,g=p.minX,m=p.maxY,x=p.minY,_=s.uvs,y=r.groupColorAlpha,v=n<<16|65535&this.roundPixels;t[i+0]=a*g+l*x+c,t[i+1]=u*x+h*g+d,t[i+2]=_.x0,t[i+3]=_.y0,e[i+4]=y,e[i+5]=v,t[i+6]=a*f+l*x+c,t[i+7]=u*x+h*f+d,t[i+8]=_.x1,t[i+9]=_.y1,e[i+10]=y,e[i+11]=v,t[i+12]=a*f+l*m+c,t[i+13]=u*m+h*f+d,t[i+14]=_.x2,t[i+15]=_.y2,e[i+16]=y,e[i+17]=v,t[i+18]=a*g+l*m+c,t[i+19]=u*m+h*g+d,t[i+20]=_.x3,t[i+21]=_.y3,e[i+22]=y,e[i+23]=v}packIndex(t,e,i){t[e]=i+0,t[e+1]=i+1,t[e+2]=i+2,t[e+3]=i+0,t[e+4]=i+2,t[e+5]=i+3}reset(){this.renderable=null,this.texture=null,this.batcher=null,this.batch=null,this.bounds=null}}},6607:(t,e,i)=>{"use strict";var n=i(8507),r=i(1979),s=i(8218),o=i(4670),a=i(4263),h=i(4835);class l extends a.mc{constructor(t){t instanceof h.T&&(t={context:t});const{context:e,roundPixels:i,...n}=t||{};super({label:"Graphics",...n}),this.canBundle=!0,this.renderPipeId="graphics",this._roundPixels=0,this._context=e||(this._ownedContext=new h.T),this._context.on("update",this.onViewUpdate,this),this.allowChildren=!1,this.roundPixels=i??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}addBounds(t){t.addBounds(this._context.bounds)}containsPoint(t){return this._context.containsPoint(t)}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}onViewUpdate(){if(this._didChangeId+=4096,this._didGraphicsUpdate=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):!0!==t&&!0!==t?.context||this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new l(this._context.clone()):(this._ownedContext=null,new l(this._context))}lineStyle(t,e,i){(0,o.t)(o.l,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const n={};return t&&(n.width=t),e&&(n.color=e),i&&(n.alpha=i),this.context.strokeStyle=n,this}beginFill(t,e){(0,o.t)(o.l,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const i={};return t&&(i.color=t),e&&(i.alpha=e),this.context.fillStyle=i,this}endFill(){(0,o.t)(o.l,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return t.width===h.T.defaultStrokeStyle.width&&t.color===h.T.defaultStrokeStyle.color&&t.alpha===h.T.defaultStrokeStyle.alpha||this.context.stroke(),this}drawCircle(...t){return(0,o.t)(o.l,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return(0,o.t)(o.l,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return(0,o.t)(o.l,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return(0,o.t)(o.l,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return(0,o.t)(o.l,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return(0,o.t)(o.l,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}var u=i(9313),c=i(6563),d=i(5611),p=i(4459),f=i(4e3),g=i(6665),m=i(6040),x=i(8475),_=i(5811);const y={name:"local-uniform-msdf-bit",vertex:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32,\n                uRound:f32,\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "},fragment:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n         ",main:" \n            outColor = vec4<f32>(calculateMSDFAlpha(outColor, localUniforms.uColor, localUniforms.uDistance));\n        "}},v={name:"local-uniform-msdf-bit",vertex:{header:"\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix *= uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "},fragment:{header:"\n            uniform float uDistance;\n         ",main:" \n            outColor = vec4(calculateMSDFAlpha(outColor, vColor, uDistance));\n        "}},b={name:"msdf-bit",fragment:{header:"\n            fn calculateMSDFAlpha(msdfColor:vec4<f32>, shapeColor:vec4<f32>, distance:f32) -> f32 {\n                \n                // MSDF\n                var median = msdfColor.r + msdfColor.g + msdfColor.b -\n                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n            \n                // SDF\n                median = min(median, msdfColor.a);\n\n                var screenPxDistance = distance * (median - 0.5);\n                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                // Gamma correction for coverage-like alpha\n                var luma: f32 = dot(shapeColor.rgb, vec3<f32>(0.299, 0.587, 0.114));\n                var gamma: f32 = mix(1.0, 1.0 / 2.2, luma);\n                var coverage: f32 = pow(shapeColor.a * alpha, gamma);\n\n                return coverage;\n             \n            }\n        "}},T={name:"msdf-bit",fragment:{header:"\n            float calculateMSDFAlpha(vec4 msdfColor, vec4 shapeColor, float distance) {\n                \n                // MSDF\n                float median = msdfColor.r + msdfColor.g + msdfColor.b -\n                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n               \n                // SDF\n                median = min(median, msdfColor.a);\n            \n                float screenPxDistance = distance * (median - 0.5);\n                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n           \n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                // Gamma correction for coverage-like alpha\n                float luma = dot(shapeColor.rgb, vec3(0.299, 0.587, 0.114));\n                float gamma = mix(1.0, 1.0 / 2.2, luma);\n                float coverage = pow(shapeColor.a * alpha, gamma);  \n              \n                return coverage;\n            }\n        "}};let w,S;class P extends x.M{constructor(){const t=new _.k({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new u.u,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}}),e=(0,c.a)();w??(w=(0,d.v)({name:"sdf-shader",bits:[p.F,(0,f._)(e),y,b,g.b]})),S??(S=(0,d.I)({name:"sdf-shader",bits:[p.a,(0,f.P)(e),v,T,g.m]})),super({glProgram:S,gpuProgram:w,resources:{localUniforms:t,batchSamplers:(0,m.n)(e)}})}}var M=i(268),E=i(8291),C=i(2577),k=i(9252),A=i(7608),B=i(8293),R=i(4492),I=i(4016),F=i(1242),z=i(3548),U=i(4486);class D extends U.A{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return(0,o.t)(o.l,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return(0,o.t)(o.l,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return(0,o.t)(o.l,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return(0,o.t)(o.l,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return(0,o.t)(o.l,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners();for(const t in this.chars)this.chars[t].texture?.destroy();this.chars=null,t&&(this.pages.forEach((t=>t.texture.destroy(!0))),this.pages=null)}}function O(t){if(""===t)return[];"string"==typeof t&&(t=[t]);const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];if(Array.isArray(n)){if(2!==n.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);if(0===n[0].length||0===n[1].length)throw new Error("[BitmapFont]: Invalid character delimiter.");const t=n[0].charCodeAt(0),i=n[1].charCodeAt(0);if(i<t)throw new Error("[BitmapFont]: Invalid character range.");for(let n=t,r=i;n<=r;n++)e.push(String.fromCharCode(n))}else e.push(...Array.from(n))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}const L=class t extends D{constructor(e){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentPageIndex=-1,this._skipKerning=!1;const i={...t.defaultOptions,...e};this._textureSize=i.textureSize,this._mipmap=i.mipmap;const n=i.style.clone();i.overrideFill&&(n._fill.color=16777215,n._fill.alpha=1,n._fill.texture=R.g.WHITE,n._fill.fill=null),this.applyFillAsTint=i.overrideFill;const r=n.fontSize;n.fontSize=this.baseMeasurementFontSize;const s=(0,F.Z)(n);i.overrideSize?n._stroke&&(n._stroke.width*=this.baseRenderedFontSize/r):n.fontSize=this.baseRenderedFontSize=r,this._style=n,this._skipKerning=i.skipKerning??!1,this.resolution=i.resolution??1,this._padding=i.padding??4,this.fontMetrics=I.P.measureFont(s),this.lineHeight=n.lineHeight||this.fontMetrics.fontSize||n.fontSize}ensureCharacters(t){const e=O(t).filter((t=>!this._currentChars.includes(t))).filter(((t,e,i)=>i.indexOf(t)===e));if(!e.length)return;let i;this._currentChars=[...this._currentChars,...e],i=-1===this._currentPageIndex?this._nextPage():this.pages[this._currentPageIndex];let{canvas:n,context:r}=i.canvasAndContext,s=i.texture.source;const o=this._style;let a=this._currentX,h=this._currentY;const l=this.baseRenderedFontSize/this.baseMeasurementFontSize,u=this._padding*l,c="italic"===o.fontStyle?2:1;let d=0,p=!1;for(let t=0;t<e.length;t++){const i=e[t],f=I.P.measureText(i,o,n,!1);f.lineHeight=f.height;const g=c*f.width*l,m=g+2*u,x=f.height*l+2*u;if(p=!1,"\n"!==i&&"\r"!==i&&"\t"!==i&&" "!==i&&(p=!0,d=Math.ceil(Math.max(x,d))),a+m>this._textureSize&&(h+=d,d=x,a=0,h+d>this._textureSize)){s.update();const t=this._nextPage();n=t.canvasAndContext.canvas,r=t.canvasAndContext.context,s=t.texture.source,h=0}const _=g/l-(o.dropShadow?.distance??0)-(o._stroke?.width??0);if(this.chars[i]={id:i.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:_,kerning:{}},p){this._drawGlyph(r,f,a+u,h+u,l,o);const t=s.width*l,e=s.height*l,n=new k.M(a/t*s.width,h/e*s.height,m/t*s.width,x/e*s.height);this.chars[i].texture=new R.g({source:s,frame:n}),a+=Math.ceil(m)}}s.update(),this._currentX=a,this._currentY=h,this._skipKerning&&this._applyKerning(e,r)}get pageTextures(){return(0,o.t)(o.l,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){const i=this._measureCache;for(let n=0;n<t.length;n++){const r=t[n];for(let t=0;t<this._currentChars.length;t++){const n=this._currentChars[t];let s=i[r];s||(s=i[r]=e.measureText(r).width);let o=i[n];o||(o=i[n]=e.measureText(n).width);let a=e.measureText(r+n).width,h=a-(s+o);h&&(this.chars[r].kerning[n]=h),a=e.measureText(r+n).width,h=a-(s+o),h&&(this.chars[n].kerning[r]=h)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,e=A.N.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);const i=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),n={canvasAndContext:e,texture:new R.g({source:new B.b({resource:e.canvas,resolution:i,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})})};return this.pages[this._currentPageIndex]=n,n}_setupContext(t,e,i){e.fontSize=this.baseRenderedFontSize,t.scale(i,i),t.font=(0,F.Z)(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const n=e._stroke,r=n?.width??0;if(n&&(t.lineWidth=r,t.lineJoin=n.join,t.miterLimit=n.miterLimit,t.strokeStyle=(0,z.r)(n,t)),e._fill&&(t.fillStyle=(0,z.r)(e._fill,t)),e.dropShadow){const n=e.dropShadow,r=C.Q.shared.setValue(n.color).toArray(),s=n.blur*i,o=n.distance*i;t.shadowColor=`rgba(${255*r[0]},${255*r[1]},${255*r[2]},${n.alpha})`,t.shadowBlur=s,t.shadowOffsetX=Math.cos(n.angle)*o,t.shadowOffsetY=Math.sin(n.angle)*o}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,i,n,r,s){const o=e.text,a=e.fontProperties,h=s._stroke,l=(h?.width??0)*r,u=i+l/2,c=n-l/2,d=a.descent*r,p=e.lineHeight*r;s.stroke&&l&&t.strokeText(o,u,c+p-d),s._fill&&t.fillText(o,u,c+p-d)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:i}=this.pages[t];e.canvas.width=e.canvas.width,A.N.returnCanvasAndContext(e),i.destroy(!0)}this.pages=null}};L.defaultOptions={textureSize:512,style:new E.x,mipmap:!0};let W=L;function G(t,e,i){const n={width:0,height:0,offsetY:0,scale:e.fontSize/i.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};n.offsetY=i.baseLineOffset;let r=n.lines[0],s=null,o=!0;const a={spaceWord:!1,width:0,start:0,index:0,positions:[],chars:[]},h=t=>{const e=r.width;for(let i=0;i<a.index;i++){const n=t.positions[i];r.chars.push(t.chars[i]),r.charPositions.push(n+e)}r.width+=t.width,o=!1,a.width=0,a.index=0,a.chars.length=0},l=()=>{let t=r.chars.length-1,e=r.chars[t];for(;" "===e;)r.width-=i.chars[e].xAdvance,e=r.chars[--t];n.width=Math.max(n.width,r.width),r={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},o=!0,n.lines.push(r),n.height+=i.lineHeight},u=i.baseMeasurementFontSize/e.fontSize,c=e.letterSpacing*u,d=e.wordWrapWidth*u;for(let n=0;n<t.length+1;n++){let u;const p=n===t.length;p||(u=t[n]);const f=i.chars[u]||i.chars[" "];if(/(?:\s)/.test(u)||"\r"===u||"\n"===u||p){if(!o&&e.wordWrap&&r.width+a.width-c>d?(l(),h(a),p||r.charPositions.push(0)):(a.start=r.width,h(a),p||r.charPositions.push(0)),"\r"===u||"\n"===u)0!==r.width&&l();else if(!p){const t=f.xAdvance+(f.kerning[s]||0)+c;r.width+=t,r.spaceWidth=t,r.spacesIndex.push(r.charPositions.length),r.chars.push(u)}}else{const t=f.kerning[s]||0,e=f.xAdvance+t+c;a.positions[a.index++]=a.width+t,a.chars.push(u),a.width+=e}s=u}return l(),"center"===e.align?function(t){for(let e=0;e<t.lines.length;e++){const i=t.lines[e],n=t.width/2-i.width/2;for(let t=0;t<i.charPositions.length;t++)i.charPositions[t]+=n}}(n):"right"===e.align?function(t){for(let e=0;e<t.lines.length;e++){const i=t.lines[e],n=t.width-i.width;for(let t=0;t<i.charPositions.length;t++)i.charPositions[t]+=n}}(n):"justify"===e.align&&function(t){const e=t.width;for(let i=0;i<t.lines.length;i++){const n=t.lines[i];let r=0,s=n.spacesIndex[r++],o=0;const a=n.spacesIndex.length,h=(e-n.width)/a;for(let t=0;t<n.charPositions.length;t++)t===s&&(s=n.spacesIndex[r++],o+=h),n.charPositions[t]+=o}}(n),n}let H=0;const $=new class{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1}}getFont(t,e){let i=`${e.fontFamily}-bitmap`,n=!0;if(e._fill.fill&&!e._stroke)i+=e._fill.fill.styleKey,n=!1;else if(e._stroke||e.dropShadow){let t=e.styleKey;t=t.substring(0,t.lastIndexOf("-")),i=`${t}-bitmap`,n=!1}if(!r.l.has(i)){const t=new W({style:e,overrideFill:n,overrideSize:!0,...this.defaultOptions});H++,H>50&&(0,M.R)("BitmapText",`You have dynamically created ${H} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),t.once("destroy",(()=>{H--,r.l.remove(i)})),r.l.set(i,t)}const s=r.l.get(i);return s.ensureCharacters?.(t),s}getLayout(t,e){const i=this.getFont(t,e);return G([...t],e,i)}measureText(t,e){return this.getLayout(t,e)}install(...t){let e=t[0];"string"==typeof e&&(e={name:e,style:t[1],chars:t[2]?.chars,resolution:t[2]?.resolution,padding:t[2]?.padding,skipKerning:t[2]?.skipKerning},(0,o.t)(o.l,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const i=e?.name;if(!i)throw new Error("[BitmapFontManager] Property `name` is required.");e={...this.defaultOptions,...e};const n=e.style,s=n instanceof E.x?n:new E.x(n),a=null!==s._fill.fill&&void 0!==s._fill.fill,h=new W({style:s,overrideFill:a,skipKerning:e.skipKerning,padding:e.padding,resolution:e.resolution,overrideSize:!1}),l=O(e.chars);return h.ensureCharacters(l.join("")),r.l.set(`${i}-bitmap`,h),h.once("destroy",(()=>r.l.remove(`${i}-bitmap`))),h}uninstall(t){const e=`${t}-bitmap`,i=r.l.get(e);i&&(r.l.remove(e),i.destroy())}};class V{constructor(t){this._gpuBitmapText={},this._renderer=t}validateRenderable(t){const e=this._getGpuBitmapText(t);return t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,e)),this._renderer.renderPipes.graphics.validateRenderable(e)}addRenderable(t,e){const i=this._getGpuBitmapText(t);X(t,i),t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,i)),this._renderer.renderPipes.graphics.addRenderable(i,e),i.context.customShader&&this._updateDistanceField(t)}destroyRenderable(t){this._destroyRenderableByUid(t.uid)}_destroyRenderableByUid(t){const e=this._gpuBitmapText[t].context;e.customShader&&(s.Z.return(e.customShader),e.customShader=null),s.Z.return(this._gpuBitmapText[t]),this._gpuBitmapText[t]=null}updateRenderable(t){const e=this._getGpuBitmapText(t);X(t,e),this._renderer.renderPipes.graphics.updateRenderable(e),e.context.customShader&&this._updateDistanceField(t)}_updateContext(t,e){const{context:i}=e,n=$.getFont(t.text,t._style);i.clear(),"none"!==n.distanceField.type&&(i.customShader||(i.customShader=s.Z.get(P)));const r=Array.from(t.text),o=t._style;let a=n.baseLineOffset;const h=G(r,o,n);let l=0;const u=o.padding,c=h.scale;let d=h.width,p=h.height+h.offsetY;o._stroke&&(d+=o._stroke.width/c,p+=o._stroke.width/c),i.translate(-t._anchor._x*d-u,-t._anchor._y*p-u).scale(c,c);const f=n.applyFillAsTint?o._fill.color:16777215;for(let t=0;t<h.lines.length;t++){const e=h.lines[t];for(let t=0;t<e.charPositions.length;t++){const s=r[l++],o=n.chars[s];o?.texture&&i.texture(o.texture,f||"black",Math.round(e.charPositions[t]+o.xOffset),Math.round(a+o.yOffset))}a+=n.lineHeight}}_getGpuBitmapText(t){return this._gpuBitmapText[t.uid]||this.initGpuText(t)}initGpuText(t){const e=s.Z.get(l);return this._gpuBitmapText[t.uid]=e,this._updateContext(t,e),t.on("destroyed",(()=>{this.destroyRenderable(t)})),this._gpuBitmapText[t.uid]}_updateDistanceField(t){const e=this._getGpuBitmapText(t).context,i=t._style.fontFamily,n=r.l.get(`${i}-bitmap`),{a:s,b:o,c:a,d:h}=t.groupTransform,l=Math.sqrt(s*s+o*o),u=Math.sqrt(a*a+h*h),c=(Math.abs(l)+Math.abs(u))/2,d=n.baseRenderedFontSize/t._style.fontSize,p=c*n.distanceField.range*(1/d);e.customShader.resources.localUniforms.uniforms.uDistance=p}destroy(){for(const t in this._gpuBitmapText)this._destroyRenderableByUid(t);this._gpuBitmapText=null,this._renderer=null}}function X(t,e){e.groupTransform=t.groupTransform,e.groupColorAlpha=t.groupColorAlpha,e.groupColor=t.groupColor,e.groupBlendMode=t.groupBlendMode,e.globalDisplayStatus=t.globalDisplayStatus,e.groupTransform=t.groupTransform,e.localDisplayStatus=t.localDisplayStatus,e.groupAlpha=t.groupAlpha,e._roundPixels=t._roundPixels}V.extension={type:[n.Ag.WebGLPipes,n.Ag.WebGPUPipes,n.Ag.CanvasPipes],name:"bitmapText"},n.XO.add(V)},7559:(t,e,i)=>{"use strict";var n=i(8507),r=i(4492),s=i(2048),o=i(8218),a=i(8422);class h{constructor(t){this._gpuText=Object.create(null),this._renderer=t,this._renderer.runners.resolutionChange.add(this)}resolutionChange(){for(const t in this._gpuText){const e=this._gpuText[t].batchableSprite.renderable;e._autoResolution&&(e._resolution=this._renderer.resolution,e.onViewUpdate())}}validateRenderable(t){const e=this._getGpuText(t),i=t._getKey();return e.textureNeedsUploading?(e.textureNeedsUploading=!1,!0):e.currentKey!==i}addRenderable(t,e){const i=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),this._renderer.renderPipes.batch.addToBatch(i)}updateRenderable(t){const e=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),e.batcher.updateElement(e)}destroyRenderable(t){this._destroyRenderableById(t.uid)}_destroyRenderableById(t){const e=this._gpuText[t];this._renderer.htmlText.decreaseReferenceCount(e.currentKey),o.Z.return(e.batchableSprite),this._gpuText[t]=null}_updateText(t){const e=t._getKey(),i=this._getGpuText(t),n=i.batchableSprite;i.currentKey!==e&&this._updateGpuText(t).catch((t=>{console.error(t)})),t._didTextUpdate=!1;const r=t._style.padding;(0,s.y)(n.bounds,t._anchor,n.texture,r)}async _updateGpuText(t){t._didTextUpdate=!1;const e=this._getGpuText(t);if(e.generatingTexture)return;const i=t._getKey();this._renderer.htmlText.decreaseReferenceCount(e.currentKey),e.generatingTexture=!0,e.currentKey=i;const n=t.resolution??this._renderer.resolution,r=await this._renderer.htmlText.getManagedTexture(t.text,n,t._style,t._getKey()),o=e.batchableSprite;o.texture=e.texture=r,e.generatingTexture=!1,e.textureNeedsUploading=!0,t.onViewUpdate();const a=t._style.padding;(0,s.y)(o.bounds,t._anchor,o.texture,a)}_getGpuText(t){return this._gpuText[t.uid]||this.initGpuText(t)}initGpuText(t){const e={texture:r.g.EMPTY,currentKey:"--",batchableSprite:o.Z.get(a.K),textureNeedsUploading:!1,generatingTexture:!1},i=e.batchableSprite;return i.renderable=t,i.texture=r.g.EMPTY,i.bounds={minX:0,maxX:1,minY:0,maxY:0},i.roundPixels=this._renderer._roundPixels|t._roundPixels,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,this._gpuText[t.uid]=e,t.on("destroyed",(()=>{this.destroyRenderable(t)})),e}destroy(){for(const t in this._gpuText)this._destroyRenderableById(t);this._gpuText=null,this._renderer=null}}h.extension={type:[n.Ag.WebGLPipes,n.Ag.WebGPUPipes,n.Ag.CanvasPipes],name:"htmlText"};var l=i(2437),u=i(5099),c=i(1761),d=i(268),p=i(2558);const f="http://www.w3.org/2000/svg",g="http://www.w3.org/1999/xhtml";class m{constructor(){this.svgRoot=document.createElementNS(f,"svg"),this.foreignObject=document.createElementNS(f,"foreignObject"),this.domElement=document.createElementNS(g,"div"),this.styleElement=document.createElementNS(g,"style"),this.image=new Image;const{foreignObject:t,svgRoot:e,styleElement:i,domElement:n}=this;t.setAttribute("width","10000"),t.setAttribute("height","10000"),t.style.overflow="hidden",e.appendChild(t),t.appendChild(i),t.appendChild(n)}}var x=i(8291),_=i(8011),y=i(2577);function v(t){const e=y.Q.shared.setValue(t.color).setAlpha(t.alpha).toHexa(),i=`${Math.round(Math.cos(t.angle)*t.distance)}px ${Math.round(Math.sin(t.angle)*t.distance)}px`;return t.blur>0?`text-shadow: ${i} ${t.blur}px ${e}`:`text-shadow: ${i} ${e}`}function b(t){return[`-webkit-text-stroke-width: ${t.width}px`,`-webkit-text-stroke-color: ${y.Q.shared.setValue(t.color).toHex()}`,`text-stroke-width: ${t.width}px`,`text-stroke-color: ${y.Q.shared.setValue(t.color).toHex()}`,"paint-order: stroke"].join(";")}const T={fontSize:"font-size: {{VALUE}}px",fontFamily:"font-family: {{VALUE}}",fontWeight:"font-weight: {{VALUE}}",fontStyle:"font-style: {{VALUE}}",fontVariant:"font-variant: {{VALUE}}",letterSpacing:"letter-spacing: {{VALUE}}px",align:"text-align: {{VALUE}}",padding:"padding: {{VALUE}}px",whiteSpace:"white-space: {{VALUE}}",lineHeight:"line-height: {{VALUE}}px",wordWrapWidth:"max-width: {{VALUE}}px"},w={fill:t=>`color: ${y.Q.shared.setValue(t).toHex()}`,breakWords:t=>"word-wrap: "+(t?"break-all":"break-word"),stroke:b,dropShadow:v};class S extends x.x{constructor(t={}){super(t),this._cssOverrides=[],this.cssOverrides??(this.cssOverrides=t.cssOverrides),this.tagStyles=t.tagStyles??{}}set cssOverrides(t){this._cssOverrides=t instanceof Array?t:[t],this.update()}get cssOverrides(){return this._cssOverrides}_generateKey(){return this._styleKey=(0,_.V)(this)+this._cssOverrides.join("-"),this._styleKey}update(){this._cssStyle=null,super.update()}clone(){return new S({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow?{...this.dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,cssOverrides:this.cssOverrides})}get cssStyle(){return this._cssStyle||(this._cssStyle=function(t){const e=t._stroke,i=t._fill,n=[`div { ${[`color: ${y.Q.shared.setValue(i.color).toHex()}`,`font-size: ${t.fontSize}px`,`font-family: ${t.fontFamily}`,`font-weight: ${t.fontWeight}`,`font-style: ${t.fontStyle}`,`font-variant: ${t.fontVariant}`,`letter-spacing: ${t.letterSpacing}px`,`text-align: ${t.align}`,`padding: ${t.padding}px`,`white-space: ${"pre"===t.whiteSpace&&t.wordWrap?"pre-wrap":t.whiteSpace}`,...t.lineHeight?[`line-height: ${t.lineHeight}px`]:[],...t.wordWrap?["word-wrap: "+(t.breakWords?"break-all":"break-word"),`max-width: ${t.wordWrapWidth}px`]:[],...e?[b(e)]:[],...t.dropShadow?[v(t.dropShadow)]:[],...t.cssOverrides].join(";")} }`];return function(t,e){for(const i in t){const n=t[i],r=[];for(const t in n)w[t]?r.push(w[t](n[t])):T[t]&&r.push(T[t].replace("{{VALUE}}",n[t]));e.push(`${i} { ${r.join(";")} }`)}}(t.tagStyles,n),n.join(" ")}(this)),this._cssStyle}addOverride(...t){const e=t.filter((t=>!this.cssOverrides.includes(t)));e.length>0&&(this.cssOverrides.push(...e),this.update())}removeOverride(...t){const e=t.filter((t=>this.cssOverrides.includes(t)));e.length>0&&(this.cssOverrides=this.cssOverrides.filter((t=>!e.includes(t))),this.update())}set fill(t){"string"!=typeof t&&"number"!=typeof t&&(0,d.R)("[HTMLTextStyle] only color fill is not supported by HTMLText"),super.fill=t}set stroke(t){t&&"string"!=typeof t&&"number"!=typeof t&&(0,d.R)("[HTMLTextStyle] only color stroke is not supported by HTMLText"),super.stroke=t}}var P=i(1979);async function M(t,e){const i=await async function(t){const e=await c.e.get().fetch(t),i=await e.blob(),n=new FileReader;return await new Promise(((t,e)=>{n.onloadend=()=>t(n.result),n.onerror=e,n.readAsDataURL(i)}))}(e);return`@font-face {\n        font-family: "${t.fontFamily}";\n        src: url('${i}');\n        font-weight: ${t.fontWeight};\n        font-style: ${t.fontStyle};\n    }`}const E=new Map;var C=i(7608),k=i(4016);let A;class B{constructor(t){this._activeTextures={},this._renderer=t,this._createCanvas=t.type===u.W.WEBGPU}getTexture(t){return this._buildTexturePromise(t.text,t.resolution,t.style)}getManagedTexture(t,e,i,n){if(this._activeTextures[n])return this._increaseReferenceCount(n),this._activeTextures[n].promise;const r=this._buildTexturePromise(t,e,i).then((t=>(this._activeTextures[n].texture=t,t)));return this._activeTextures[n]={texture:null,promise:r,usageCount:1},r}async _buildTexturePromise(t,e,i){const n=o.Z.get(m),r=function(t,e){const i=e.fontFamily,n=[],r={},s=t.match(/font-family:([^;"\s]+)/g);function o(t){r[t]||(n.push(t),r[t]=!0)}if(Array.isArray(i))for(let t=0;t<i.length;t++)o(i[t]);else o(i);s&&s.forEach((t=>{o(t.split(":")[1].trim())}));for(const t in e.tagStyles)o(e.tagStyles[t].fontFamily);return n}(t,i),s=await async function(t,e,i){const n=t.filter((t=>P.l.has(`${t}-and-url`))).map(((t,n)=>{if(!E.has(t)){const{url:r}=P.l.get(`${t}-and-url`);0===n?E.set(t,M({fontWeight:e.fontWeight,fontStyle:e.fontStyle,fontFamily:t},r)):E.set(t,M({fontWeight:i.fontWeight,fontStyle:i.fontStyle,fontFamily:t},r))}return E.get(t)}));return(await Promise.all(n)).join("\n")}(r,i,S.defaultTextStyle),a=function(t,e,i,n){n=n||A||(A=new m);const{domElement:r,styleElement:s,svgRoot:o}=n;r.innerHTML=`<style>${e.cssStyle};</style><div style='padding:0'>${t}</div>`,r.setAttribute("style","transform-origin: top left; display: inline-block"),i&&(s.textContent=i),document.body.appendChild(o);const a=r.getBoundingClientRect();o.remove();const h=k.P.measureFont(e.fontStyle).descent,l=2*e.padding;return{width:a.width-l,height:a.height+h-l}}(t,i,s,n),h=Math.ceil(Math.ceil(Math.max(1,a.width)+2*i.padding)*e),l=Math.ceil(Math.ceil(Math.max(1,a.height)+2*i.padding)*e),u=n.image;u.width=2+(0|h),u.height=2+(0|l);const d=function(t,e,i,n,r){const{domElement:s,styleElement:o,svgRoot:a}=r;s.innerHTML=`<style>${e.cssStyle}</style><div style='padding:0;'>${t}</div>`,s.setAttribute("style",`transform: scale(${i});transform-origin: top left; display: inline-block`),o.textContent=n;const{width:h,height:l}=r.image;return a.setAttribute("width",h.toString()),a.setAttribute("height",l.toString()),(new XMLSerializer).serializeToString(a)}(t,i,e,s,n);await function(t,e,i){return new Promise((async n=>{i&&await new Promise((t=>setTimeout(t,100))),t.onload=()=>{n()},t.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(e)}`,t.crossOrigin="anonymous"}))}(u,d,function(){const{userAgent:t}=c.e.get().getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}()&&r.length>0);let f=u;this._createCanvas&&(f=function(t,e){const i=C.N.getOptimalCanvasAndContext(t.width,t.height,e),{context:n}=i;return n.clearRect(0,0,t.width,t.height),n.drawImage(t,0,0),C.N.returnCanvasAndContext(i),i.canvas}(u,e));const g=(0,p.M)(f,u.width-2,u.height-2,e);return this._createCanvas&&this._renderer.texture.initSource(g.source),o.Z.return(n),g}_increaseReferenceCount(t){this._activeTextures[t].usageCount++}decreaseReferenceCount(t){const e=this._activeTextures[t];e&&(e.usageCount--,0===e.usageCount&&(e.texture?this._cleanUp(e):e.promise.then((t=>{e.texture=t,this._cleanUp(e)})).catch((()=>{(0,d.R)("HTMLTextSystem: Failed to clean texture")})),this._activeTextures[t]=null))}_cleanUp(t){l.W.returnTexture(t.texture),t.texture.source.resource=null,t.texture.source.uploadMethodId="unknown"}getReferenceCount(t){return this._activeTextures[t].usageCount}destroy(){this._activeTextures=null}}B.extension={type:[n.Ag.WebGLSystem,n.Ag.WebGPUSystem,n.Ag.CanvasSystem],name:"htmlText"},B.defaultFontOptions={fontFamily:"Arial",fontStyle:"normal",fontWeight:"normal"},n.XO.add(B),n.XO.add(h)},8291:(t,e,i)=>{"use strict";i.d(e,{x:()=>d});var n=i(4486),r=i(2577),s=i(4670),o=i(7276),a=i(2806),h=i(4835),l=i(990),u=i(8011);const c=class t extends n.A{constructor(e={}){super(),function(t){const e=t;if("boolean"==typeof e.dropShadow&&e.dropShadow){const i=d.defaultDropShadow;t.dropShadow={alpha:e.dropShadowAlpha??i.alpha,angle:e.dropShadowAngle??i.angle,blur:e.dropShadowBlur??i.blur,color:e.dropShadowColor??i.color,distance:e.dropShadowDistance??i.distance}}if(void 0!==e.strokeThickness){(0,s.t)(s.l,"strokeThickness is now a part of stroke");const i=e.stroke;let n={};if(r.Q.isColorLike(i))n.color=i;else if(i instanceof o._||i instanceof a.m)n.fill=i;else{if(!Object.hasOwnProperty.call(i,"color")&&!Object.hasOwnProperty.call(i,"fill"))throw new Error("Invalid stroke value.");n=i}t.stroke={...n,width:e.strokeThickness}}if(Array.isArray(e.fillGradientStops)){let i;(0,s.t)(s.l,"gradient fill is now a fill pattern: `new FillGradient(...)`"),null==t.fontSize?t.fontSize=d.defaultTextStyle.fontSize:i="string"==typeof t.fontSize?parseInt(t.fontSize,10):t.fontSize;const n=new o._(0,0,0,1.7*i),a=e.fillGradientStops.map((t=>r.Q.shared.setValue(t).toNumber()));a.forEach(((t,e)=>{const i=e/(a.length-1);n.addColorStop(i,t)})),t.fill={fill:n}}}(e);const i={...t.defaultTextStyle,...e};for(const t in i)this[t]=i[t];this.update()}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow=null!==e&&"object"==typeof e?this._createProxy({...t.defaultDropShadow,...e}):e?this._createProxy({...t.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize="string"==typeof t?parseInt(t,10):t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t,this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...h.T.defaultFillStyle,...t},(()=>{this._fill=(0,l.w)({...this._originalFill},h.T.defaultFillStyle)}))),this._fill=(0,l.w)(0===t?"black":t,h.T.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...h.T.defaultStrokeStyle,...t},(()=>{this._stroke=(0,l.T)({...this._originalStroke},h.T.defaultStrokeStyle)}))),this._stroke=(0,l.T)(t,h.T.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=(0,u.V)(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){const e=t.defaultTextStyle;for(const t in e)this[t]=e[t]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new t({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth})}destroy(t=!1){if(this.removeAllListeners(),"boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.textureSource;this._fill?.texture&&this._fill.texture.destroy(e),this._originalFill?.texture&&this._originalFill.texture.destroy(e),this._stroke?.texture&&this._stroke.texture.destroy(e),this._originalStroke?.texture&&this._originalStroke.texture.destroy(e)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(t,i,n)=>(t[i]=n,e?.(i,n),this.update(),!0)})}_isFillStyle(t){return null!==(t??null)&&!(r.Q.isColorLike(t)||t instanceof o._||t instanceof a.m)}};c.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5},c.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let d=c},4016:(t,e,i)=>{"use strict";i.d(e,{P:()=>a});var n=i(1761),r=i(1242);const s={willReadFrequently:!0},o=class t{static get experimentalLetterSpacingSupported(){let e=t._experimentalLetterSpacingSupported;if(void 0!==e){const i=n.e.get().getCanvasRenderingContext2D().prototype;e=t._experimentalLetterSpacingSupported="letterSpacing"in i||"textLetterSpacing"in i}return e}constructor(t,e,i,n,r,s,o,a,h){this.text=t,this.style=e,this.width=i,this.height=n,this.lines=r,this.lineWidths=s,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=h}static measureText(e=" ",i,n=t._canvas,s=i.wordWrap){const o=`${e}:${i.styleKey}`;if(t._measurementCache[o])return t._measurementCache[o];const a=(0,r.Z)(i),h=t.measureFont(a);0===h.fontSize&&(h.fontSize=i.fontSize,h.ascent=i.fontSize);const l=t.__context;l.font=a;const u=(s?t._wordWrap(e,i,n):e).split(/(?:\r\n|\r|\n)/),c=new Array(u.length);let d=0;for(let e=0;e<u.length;e++){const n=t._measureText(u[e],i.letterSpacing,l);c[e]=n,d=Math.max(d,n)}const p=i._stroke?.width||0;let f=d+p;i.dropShadow&&(f+=i.dropShadow.distance);const g=i.lineHeight||h.fontSize;let m=Math.max(g,h.fontSize+p)+(u.length-1)*(g+i.leading);return i.dropShadow&&(m+=i.dropShadow.distance),new t(e,i,f,m,u,c,g+i.leading,d,h)}static _measureText(e,i,n){let r=!1;t.experimentalLetterSpacingSupported&&(t.experimentalLetterSpacing?(n.letterSpacing=`${i}px`,n.textLetterSpacing=`${i}px`,r=!0):(n.letterSpacing="0px",n.textLetterSpacing="0px"));let s=n.measureText(e).width;return s>0&&(r?s-=i:s+=(t.graphemeSegmenter(e).length-1)*i),s}static _wordWrap(e,i,n=t._canvas){const r=n.getContext("2d",s);let o=0,a="",h="";const l=Object.create(null),{letterSpacing:u,whiteSpace:c}=i,d=t._collapseSpaces(c),p=t._collapseNewlines(c);let f=!d;const g=i.wordWrapWidth+u,m=t._tokenize(e);for(let e=0;e<m.length;e++){let n=m[e];if(t._isNewline(n)){if(!p){h+=t._addLine(a),f=!d,a="",o=0;continue}n=" "}if(d){const e=t.isBreakingSpace(n),i=t.isBreakingSpace(a[a.length-1]);if(e&&i)continue}const s=t._getFromCache(n,u,l,r);if(s>g)if(""!==a&&(h+=t._addLine(a),a="",o=0),t.canBreakWords(n,i.breakWords)){const e=t.wordWrapSplit(n);for(let s=0;s<e.length;s++){let c=e[s],d=c,p=1;for(;e[s+p];){const r=e[s+p];if(t.canBreakChars(d,r,n,s,i.breakWords))break;c+=r,d=r,p++}s+=p-1;const m=t._getFromCache(c,u,l,r);m+o>g&&(h+=t._addLine(a),f=!1,a="",o=0),a+=c,o+=m}}else{a.length>0&&(h+=t._addLine(a),a="",o=0);const i=e===m.length-1;h+=t._addLine(n,!i),f=!1,a="",o=0}else s+o>g&&(f=!1,h+=t._addLine(a),a="",o=0),(a.length>0||!t.isBreakingSpace(n)||f)&&(a+=n,o+=s)}return h+=t._addLine(a,!1),h}static _addLine(e,i=!0){return e=t._trimRight(e),i?`${e}\n`:e}static _getFromCache(e,i,n,r){let s=n[e];return"number"!=typeof s&&(s=t._measureText(e,i,r)+i,n[e]=s),s}static _collapseSpaces(t){return"normal"===t||"pre-line"===t}static _collapseNewlines(t){return"normal"===t}static _trimRight(e){if("string"!=typeof e)return"";for(let i=e.length-1;i>=0;i--){const n=e[i];if(!t.isBreakingSpace(n))break;e=e.slice(0,-1)}return e}static _isNewline(e){return"string"==typeof e&&t._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,i){return"string"==typeof e&&t._breakingSpaces.includes(e.charCodeAt(0))}static _tokenize(e){const i=[];let n="";if("string"!=typeof e)return i;for(let r=0;r<e.length;r++){const s=e[r],o=e[r+1];t.isBreakingSpace(s,o)||t._isNewline(s)?(""!==n&&(i.push(n),n=""),i.push(s)):n+=s}return""!==n&&i.push(n),i}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,n,r){return!0}static wordWrapSplit(e){return t.graphemeSegmenter(e)}static measureFont(e){if(t._fonts[e])return t._fonts[e];const i=t._context;i.font=e;const n=i.measureText(t.METRICS_STRING+t.BASELINE_SYMBOL),r={ascent:n.actualBoundingBoxAscent,descent:n.actualBoundingBoxDescent,fontSize:n.actualBoundingBoxAscent+n.actualBoundingBoxDescent};return t._fonts[e]=r,r}static clearMetrics(e=""){e?delete t._fonts[e]:t._fonts={}}static get _canvas(){if(!t.__canvas){let e;try{const i=new OffscreenCanvas(0,0),r=i.getContext("2d",s);if(r?.measureText)return t.__canvas=i,i;e=n.e.get().createCanvas()}catch(t){e=n.e.get().createCanvas()}e.width=e.height=10,t.__canvas=e}return t.__canvas}static get _context(){return t.__context||(t.__context=t._canvas.getContext("2d",s)),t.__context}};o.METRICS_STRING="|q",o.BASELINE_SYMBOL="M",o.BASELINE_MULTIPLIER=1.4,o.HEIGHT_MULTIPLIER=2,o.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),o.experimentalLetterSpacing=!1,o._fonts={},o._newlines=[10,13],o._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288],o._measurementCache={};let a=o},1242:(t,e,i)=>{"use strict";i.d(e,{Z:()=>r});const n=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function r(t){const e="number"==typeof t.fontSize?`${t.fontSize}px`:t.fontSize;let i=t.fontFamily;Array.isArray(t.fontFamily)||(i=t.fontFamily.split(","));for(let t=i.length-1;t>=0;t--){let e=i[t].trim();/([\"\'])[^\'\"]+\1/.test(e)||n.includes(e)||(e=`"${e}"`),i[t]=e}return`${t.fontStyle} ${t.fontVariant} ${t.fontWeight} ${e} ${i.join(",")}`}},3548:(t,e,i)=>{"use strict";i.d(e,{r:()=>l});var n=i(2577),r=i(9313),s=i(4492),o=i(268),a=i(7276),h=i(2806);function l(t,e){if(t.texture===s.g.WHITE&&!t.fill)return n.Q.shared.setValue(t.color).toHex();if(!t.fill){const i=e.createPattern(t.texture.source.resource,"repeat"),n=t.matrix.copyTo(r.u.shared);return n.scale(t.texture.frame.width,t.texture.frame.height),i.setTransform(n),i}if(t.fill instanceof h.m){const i=t.fill,n=e.createPattern(i.texture.source.resource,"repeat"),s=i.transform.copyTo(r.u.shared);return s.scale(i.texture.frame.width,i.texture.frame.height),n.setTransform(s),n}if(t.fill instanceof a._){const i=t.fill;if("linear"===i.type){const t=e.createLinearGradient(i.x0,i.y0,i.x1,i.y1);return i.gradientStops.forEach((e=>{t.addColorStop(e.offset,n.Q.shared.setValue(e.color).toHex())})),t}}return(0,o.R)("FillStyle not recognised",t),"red"}},6958:(t,e,i)=>{"use strict";var n=i(8507),r=i(2048),s=i(8218),o=i(8422);class a{constructor(t){this._gpuText=Object.create(null),this._renderer=t,this._renderer.runners.resolutionChange.add(this)}resolutionChange(){for(const t in this._gpuText){const e=this._gpuText[t].batchableSprite.renderable;e._autoResolution&&(e._resolution=this._renderer.resolution,e.onViewUpdate())}}validateRenderable(t){const e=this._getGpuText(t),i=t._getKey();if(e.currentKey!==i){const{width:i,height:n}=this._renderer.canvasText.getTextureSize(t.text,t.resolution,t._style);return 1!==this._renderer.canvasText.getReferenceCount(e.currentKey)||i!==e.texture._source.width||n!==e.texture._source.height}return!1}addRenderable(t,e){const i=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),this._renderer.renderPipes.batch.addToBatch(i)}updateRenderable(t){const e=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),e.batcher.updateElement(e)}destroyRenderable(t){this._destroyRenderableById(t.uid)}_destroyRenderableById(t){const e=this._gpuText[t];this._renderer.canvasText.decreaseReferenceCount(e.currentKey),s.Z.return(e.batchableSprite),this._gpuText[t]=null}_updateText(t){const e=t._getKey(),i=this._getGpuText(t),n=i.batchableSprite;i.currentKey!==e&&this._updateGpuText(t),t._didTextUpdate=!1;const s=t._style.padding;(0,r.y)(n.bounds,t._anchor,n.texture,s)}_updateGpuText(t){const e=this._getGpuText(t),i=e.batchableSprite;e.texture&&this._renderer.canvasText.decreaseReferenceCount(e.currentKey),e.texture=i.texture=this._renderer.canvasText.getManagedTexture(t),e.currentKey=t._getKey(),i.texture=e.texture}_getGpuText(t){return this._gpuText[t.uid]||this.initGpuText(t)}initGpuText(t){const e={texture:null,currentKey:"--",batchableSprite:s.Z.get(o.K)};return e.batchableSprite.renderable=t,e.batchableSprite.bounds={minX:0,maxX:1,minY:0,maxY:0},e.batchableSprite.roundPixels=this._renderer._roundPixels|t._roundPixels,this._gpuText[t.uid]=e,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,this._updateText(t),t.on("destroyed",(()=>{this.destroyRenderable(t)})),e}destroy(){for(const t in this._gpuText)this._destroyRenderableById(t);this._gpuText=null,this._renderer=null}}a.extension={type:[n.Ag.WebGLPipes,n.Ag.WebGPUPipes,n.Ag.CanvasPipes],name:"text"};var h=i(2577),l=i(9939),u=i(7608),c=i(2437),d=i(9252);function p(t,e,i){for(let n=0,r=4*i*e;n<e;++n,r+=4)if(0!==t[r+3])return!1;return!0}function f(t,e,i,n,r){const s=4*e;for(let e=n,o=n*s+4*i;e<=r;++e,o+=s)if(0!==t[o+3])return!1;return!0}var g=i(4670),m=i(8291),x=i(2558),_=i(4016),y=i(1242),v=i(3548);class b{constructor(t){this._activeTextures={},this._renderer=t}getTextureSize(t,e,i){const n=_.P.measureText(t||" ",i);let r=Math.ceil(Math.ceil(Math.max(1,n.width)+2*i.padding)*e),s=Math.ceil(Math.ceil(Math.max(1,n.height)+2*i.padding)*e);return r=Math.ceil(r-1e-6),s=Math.ceil(s-1e-6),r=(0,l.U5)(r),s=(0,l.U5)(s),{width:r,height:s}}getTexture(t,e,i,n){"string"==typeof t&&((0,g.t)("8.0.0","CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),t={text:t,style:i,resolution:e}),t.style instanceof m.x||(t.style=new m.x(t.style));const{texture:r,canvasAndContext:s}=this.createTextureAndCanvas(t);return this._renderer.texture.initSource(r._source),u.N.returnCanvasAndContext(s),r}createTextureAndCanvas(t){const{text:e,style:i}=t,n=t.resolution??this._renderer.resolution,r=_.P.measureText(e||" ",i),s=Math.ceil(Math.ceil(Math.max(1,r.width)+2*i.padding)*n),o=Math.ceil(Math.ceil(Math.max(1,r.height)+2*i.padding)*n),a=u.N.getOptimalCanvasAndContext(s,o),{canvas:h}=a;this.renderTextToCanvas(e,i,n,a);const l=(0,x.M)(h,s,o,n);if(i.trim){const t=function(t,e=1){const{width:i,height:n}=t,r=t.getContext("2d",{willReadFrequently:!0});if(null===r)throw new TypeError("Failed to get canvas 2D context");const s=r.getImageData(0,0,i,n).data;let o=0,a=0,h=i-1,l=n-1;for(;a<n&&p(s,i,a);)++a;if(a===n)return d.M.EMPTY;for(;p(s,i,l);)--l;for(;f(s,i,o,a,l);)++o;for(;f(s,i,h,a,l);)--h;return++h,++l,new d.M(o/e,a/e,(h-o)/e,(l-a)/e)}(h,n);l.frame.copyFrom(t),l.updateUvs()}return{texture:l,canvasAndContext:a}}getManagedTexture(t){t._resolution=t._autoResolution?this._renderer.resolution:t.resolution;const e=t._getKey();if(this._activeTextures[e])return this._increaseReferenceCount(e),this._activeTextures[e].texture;const{texture:i,canvasAndContext:n}=this.createTextureAndCanvas(t);return this._activeTextures[e]={canvasAndContext:n,texture:i,usageCount:1},i}_increaseReferenceCount(t){this._activeTextures[t].usageCount++}decreaseReferenceCount(t){const e=this._activeTextures[t];if(e.usageCount--,0===e.usageCount){u.N.returnCanvasAndContext(e.canvasAndContext),c.W.returnTexture(e.texture);const i=e.texture.source;i.resource=null,i.uploadMethodId="unknown",i.alphaMode="no-premultiply-alpha",this._activeTextures[t]=null}}getReferenceCount(t){return this._activeTextures[t].usageCount}renderTextToCanvas(t,e,i,n){const{canvas:r,context:s}=n,o=(0,y.Z)(e),a=_.P.measureText(t||" ",e),l=a.lines,u=a.lineHeight,c=a.lineWidths,d=a.maxLineWidth,p=a.fontProperties,f=r.height;s.resetTransform(),s.scale(i,i);const g=2*e.padding;if(s.clearRect(0,0,a.width+4+g,a.height+4+g),e._stroke?.width){const t=e._stroke;s.lineWidth=t.width,s.miterLimit=t.miterLimit,s.lineJoin=t.join,s.lineCap=t.cap}let m,x;s.font=o;const b=e.dropShadow?2:1;for(let t=0;t<b;++t){const r=e.dropShadow&&0===t,o=r?Math.ceil(Math.max(1,f)+2*e.padding):0,a=o*i;if(r){s.fillStyle="black",s.strokeStyle="black";const t=e.dropShadow,n=t.color,r=t.alpha;s.shadowColor=h.Q.shared.setValue(n).setAlpha(r).toRgbaString();const o=t.blur*i,l=t.distance*i;s.shadowBlur=o,s.shadowOffsetX=Math.cos(t.angle)*l,s.shadowOffsetY=Math.sin(t.angle)*l+a}else s.globalAlpha=e._fill?.alpha??1,s.fillStyle=e._fill?(0,v.r)(e._fill,s):null,e._stroke?.width&&(s.strokeStyle=(0,v.r)(e._stroke,s)),s.shadowColor="black";let g=(u-p.fontSize)/2;u-p.fontSize<0&&(g=0);const _=e._stroke?.width??0;for(let t=0;t<l.length;t++)m=_/2,x=_/2+t*u+p.ascent+g,"right"===e.align?m+=d-c[t]:"center"===e.align&&(m+=(d-c[t])/2),e._stroke?.width&&this._drawLetterSpacing(l[t],e,n,m+e.padding,x+e.padding-o,!0),void 0!==e._fill&&this._drawLetterSpacing(l[t],e,n,m+e.padding,x+e.padding-o)}}_drawLetterSpacing(t,e,i,n,r,s=!1){const{context:o}=i,a=e.letterSpacing;let h=!1;if(_.P.experimentalLetterSpacingSupported&&(_.P.experimentalLetterSpacing?(o.letterSpacing=`${a}px`,o.textLetterSpacing=`${a}px`,h=!0):(o.letterSpacing="0px",o.textLetterSpacing="0px")),0===a||h)return void(s?o.strokeText(t,n,r):o.fillText(t,n,r));let l=n;const u=_.P.graphemeSegmenter(t);let c=o.measureText(t).width,d=0;for(let t=0;t<u.length;++t){const e=u[t];s?o.strokeText(e,l,r):o.fillText(e,l,r);let i="";for(let e=t+1;e<u.length;++e)i+=u[e];d=o.measureText(i).width,l+=c-d+a,c=d}}destroy(){this._activeTextures=null}}b.extension={type:[n.Ag.WebGLSystem,n.Ag.WebGPUSystem,n.Ag.CanvasSystem],name:"canvasText"},n.XO.add(b),n.XO.add(a)},8011:(t,e,i)=>{"use strict";i.d(e,{V:()=>s});var n=i(2577);const r=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"];function s(t){const e=[];let i=0;for(let n=0;n<r.length;n++){const s=`_${r[n]}`;e[i++]=t[s]}return i=o(t._fill,e,i),i=function(t,e,i){return t?(i=o(t,e,i),e[i++]=t.width,e[i++]=t.alignment,e[i++]=t.cap,e[i++]=t.join,e[i++]=t.miterLimit,i):i}(t._stroke,e,i),i=function(t,e,i){return t?(e[i++]=t.alpha,e[i++]=t.angle,e[i++]=t.blur,e[i++]=t.distance,e[i++]=n.Q.shared.setValue(t.color).toNumber(),i):i}(t.dropShadow,e,i),e.join("-")}function o(t,e,i){return t?(e[i++]=t.color,e[i++]=t.alpha,e[i++]=t.fill?.styleKey,i):i}},2558:(t,e,i)=>{"use strict";i.d(e,{M:()=>s});var n=i(2437);const r=new(i(9636).c);function s(t,e,i,s){const o=r;o.minX=0,o.minY=0,o.maxX=t.width/s|0,o.maxY=t.height/s|0;const a=n.W.getOptimalTexture(o.width,o.height,s,!1);return a.source.uploadMethodId="image",a.source.resource=t,a.source.alphaMode="premultiply-alpha-on-upload",a.frame.width=e/s,a.frame.height=i/s,a.source.emit("update",a.source),a.updateUvs(),a}}}]);